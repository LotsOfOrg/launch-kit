<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Secure, simple authentication utilities for FastHTML applications">

<title>Authentication ‚Äì ship-kit</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-b1527d6dab3c1d2528611d399e709420.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Authentication ‚Äì ship-kit">
<meta property="og:description" content="Secure, simple authentication utilities for FastHTML applications">
<meta property="og:site_name" content="ship-kit">
<meta name="twitter:title" content="Authentication ‚Äì ship-kit">
<meta name="twitter:description" content="Secure, simple authentication utilities for FastHTML applications">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">ship-kit</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./auth.html">Authentication</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ship-kit</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./auth.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Authentication</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./routes_auth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">routes.auth</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./permissions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Permissions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./admin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Admin Panel</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./admin_routes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">admin_routes</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#imports-and-utils" id="toc-imports-and-utils" class="nav-link active" data-scroll-target="#imports-and-utils">Imports and utils</a></li>
  <li><a href="#quick-start" id="toc-quick-start" class="nav-link" data-scroll-target="#quick-start">Quick Start</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
  <li><a href="#core-functions" id="toc-core-functions" class="nav-link" data-scroll-target="#core-functions">Core Functions</a></li>
  <li><a href="#database-functions" id="toc-database-functions" class="nav-link" data-scroll-target="#database-functions">Database Functions</a></li>
  <li><a href="#helper-functions" id="toc-helper-functions" class="nav-link" data-scroll-target="#helper-functions">Helper Functions</a></li>
  </ul></li>
  <li><a href="#password-hashing" id="toc-password-hashing" class="nav-link" data-scroll-target="#password-hashing">Password Hashing</a>
  <ul class="collapse">
  <li><a href="#hash_password" id="toc-hash_password" class="nav-link" data-scroll-target="#hash_password">hash_password</a></li>
  <li><a href="#verify_password" id="toc-verify_password" class="nav-link" data-scroll-target="#verify_password">verify_password</a></li>
  </ul></li>
  <li><a href="#user-model" id="toc-user-model" class="nav-link" data-scroll-target="#user-model">User Model</a>
  <ul class="collapse">
  <li><a href="#user" id="toc-user" class="nav-link" data-scroll-target="#user">User</a></li>
  <li><a href="#init_auth_tables" id="toc-init_auth_tables" class="nav-link" data-scroll-target="#init_auth_tables">init_auth_tables</a></li>
  </ul></li>
  <li><a href="#user-crud-operations" id="toc-user-crud-operations" class="nav-link" data-scroll-target="#user-crud-operations">User CRUD Operations</a>
  <ul class="collapse">
  <li><a href="#create_user" id="toc-create_user" class="nav-link" data-scroll-target="#create_user">create_user</a></li>
  <li><a href="#get_user_by_id" id="toc-get_user_by_id" class="nav-link" data-scroll-target="#get_user_by_id">get_user_by_id</a></li>
  <li><a href="#get_user_by_email" id="toc-get_user_by_email" class="nav-link" data-scroll-target="#get_user_by_email">get_user_by_email</a></li>
  <li><a href="#get_user_by_username" id="toc-get_user_by_username" class="nav-link" data-scroll-target="#get_user_by_username">get_user_by_username</a></li>
  <li><a href="#update_user" id="toc-update_user" class="nav-link" data-scroll-target="#update_user">update_user</a></li>
  <li><a href="#delete_user" id="toc-delete_user" class="nav-link" data-scroll-target="#delete_user">delete_user</a></li>
  </ul></li>
  <li><a href="#authentication-helpers" id="toc-authentication-helpers" class="nav-link" data-scroll-target="#authentication-helpers">Authentication Helpers</a>
  <ul class="collapse">
  <li><a href="#check_permission" id="toc-check_permission" class="nav-link" data-scroll-target="#check_permission">check_permission</a></li>
  <li><a href="#authenticate_user" id="toc-authenticate_user" class="nav-link" data-scroll-target="#authenticate_user">authenticate_user</a></li>
  <li><a href="#track_login" id="toc-track_login" class="nav-link" data-scroll-target="#track_login">track_login</a></li>
  <li><a href="#userlogin" id="toc-userlogin" class="nav-link" data-scroll-target="#userlogin">UserLogin</a></li>
  <li><a href="#comparison-raw-sql-vs-minidataapi" id="toc-comparison-raw-sql-vs-minidataapi" class="nav-link" data-scroll-target="#comparison-raw-sql-vs-minidataapi">Comparison: Raw SQL vs MiniDataAPI</a></li>
  <li><a href="#migration-considerations" id="toc-migration-considerations" class="nav-link" data-scroll-target="#migration-considerations">Migration Considerations</a></li>
  </ul></li>
  <li><a href="#validation-helpers" id="toc-validation-helpers" class="nav-link" data-scroll-target="#validation-helpers">Validation Helpers</a>
  <ul class="collapse">
  <li><a href="#is_username_available" id="toc-is_username_available" class="nav-link" data-scroll-target="#is_username_available">is_username_available</a></li>
  <li><a href="#is_email_available" id="toc-is_email_available" class="nav-link" data-scroll-target="#is_email_available">is_email_available</a></li>
  <li><a href="#validate_user_data" id="toc-validate_user_data" class="nav-link" data-scroll-target="#validate_user_data">validate_user_data</a></li>
  </ul></li>
  <li><a href="#session-management" id="toc-session-management" class="nav-link" data-scroll-target="#session-management">Session Management</a>
  <ul class="collapse">
  <li><a href="#protecting-routes-with-beforeware" id="toc-protecting-routes-with-beforeware" class="nav-link" data-scroll-target="#protecting-routes-with-beforeware">Protecting Routes with Beforeware</a></li>
  <li><a href="#user_auth_before" id="toc-user_auth_before" class="nav-link" data-scroll-target="#user_auth_before">user_auth_before</a></li>
  <li><a href="#session-schema" id="toc-session-schema" class="nav-link" data-scroll-target="#session-schema">Session Schema</a></li>
  <li><a href="#get_user_from_session" id="toc-get_user_from_session" class="nav-link" data-scroll-target="#get_user_from_session">get_user_from_session</a></li>
  <li><a href="#working-with-user-sessions" id="toc-working-with-user-sessions" class="nav-link" data-scroll-target="#working-with-user-sessions">Working with User Sessions</a></li>
  </ul></li>
  <li><a href="#authentication-tokens" id="toc-authentication-tokens" class="nav-link" data-scroll-target="#authentication-tokens">Authentication Tokens</a>
  <ul class="collapse">
  <li><a href="#create_auth_token" id="toc-create_auth_token" class="nav-link" data-scroll-target="#create_auth_token">create_auth_token</a></li>
  <li><a href="#verify_auth_token" id="toc-verify_auth_token" class="nav-link" data-scroll-target="#verify_auth_token">verify_auth_token</a></li>
  </ul></li>
  <li><a href="#security-best-practices" id="toc-security-best-practices" class="nav-link" data-scroll-target="#security-best-practices">Security Best Practices</a>
  <ul class="collapse">
  <li><a href="#password-security" id="toc-password-security" class="nav-link" data-scroll-target="#password-security">üîê Password Security</a></li>
  <li><a href="#session-security" id="toc-session-security" class="nav-link" data-scroll-target="#session-security">üç™ Session Security</a></li>
  <li><a href="#token-security" id="toc-token-security" class="nav-link" data-scroll-target="#token-security">üé´ Token Security</a></li>
  <li><a href="#general-security" id="toc-general-security" class="nav-link" data-scroll-target="#general-security">üåê General Security</a></li>
  </ul></li>
  <li><a href="#complete-database-example" id="toc-complete-database-example" class="nav-link" data-scroll-target="#complete-database-example">Complete Database Example</a></li>
  <li><a href="#database-tests" id="toc-database-tests" class="nav-link" data-scroll-target="#database-tests">Database Tests</a>
  <ul class="collapse">
  <li><a href="#quick-example" id="toc-quick-example" class="nav-link" data-scroll-target="#quick-example">Quick Example</a></li>
  <li><a href="#complete-loginsignup-example" id="toc-complete-loginsignup-example" class="nav-link" data-scroll-target="#complete-loginsignup-example">Complete Login/Signup Example</a></li>
  <li><a href="#token-usage-example" id="toc-token-usage-example" class="nav-link" data-scroll-target="#token-usage-example">Token Usage Example</a></li>
  <li><a href="#remember-me-implementation" id="toc-remember-me-implementation" class="nav-link" data-scroll-target="#remember-me-implementation">Remember Me Implementation</a></li>
  </ul></li>
  <li><a href="#complete-example-interactive-demo" id="toc-complete-example-interactive-demo" class="nav-link" data-scroll-target="#complete-example-interactive-demo">Complete Example: Interactive Demo</a>
  <ul class="collapse">
  <li><a href="#automated-testing" id="toc-automated-testing" class="nav-link" data-scroll-target="#automated-testing">Automated Testing</a></li>
  <li><a href="#manual-testing" id="toc-manual-testing" class="nav-link" data-scroll-target="#manual-testing">Manual Testing</a></li>
  </ul></li>
  <li><a href="#auth-tests" id="toc-auth-tests" class="nav-link" data-scroll-target="#auth-tests">Auth Tests</a></li>
  <li><a href="#performance-benchmarks" id="toc-performance-benchmarks" class="nav-link" data-scroll-target="#performance-benchmarks">Performance Benchmarks</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a>
  <ul class="collapse">
  <li><a href="#breaking-changes-in-v2.0" id="toc-breaking-changes-in-v2.0" class="nav-link" data-scroll-target="#breaking-changes-in-v2.0">Breaking Changes in v2.0</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/LotsOfOrg/ship-kit/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="auth.html.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Authentication</h1>
</div>

<div>
  <div class="description">
    Secure, simple authentication utilities for FastHTML applications
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="imports-and-utils" class="level2">
<h2 class="anchored" data-anchor-id="imports-and-utils">Imports and utils</h2>
</section>
<section id="quick-start" class="level2">
<h2 class="anchored" data-anchor-id="quick-start">Quick Start</h2>
<p>Ship Kit‚Äôs authentication module provides everything you need to add secure authentication to your FastHTML app in minutes:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ship_kit.auth <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fasthtml.common <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Initialize the database</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> init_auth_tables()  <span class="co"># Creates users table with indexes</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Create a new user</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>user <span class="op">=</span> create_user(db, <span class="st">'john_doe'</span>, <span class="st">'john@example.com'</span>, <span class="st">'secure_password123'</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Authenticate users during login</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>user <span class="op">=</span> authenticate_user(db, <span class="st">'john@example.com'</span>, <span class="st">'secure_password123'</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> user:</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    sess[<span class="st">'auth'</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    sess[<span class="st">'user'</span>] <span class="op">=</span> {<span class="st">'id'</span>: user[<span class="st">'id'</span>], <span class="st">'username'</span>: user[<span class="st">'username'</span>]}</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Protect routes with authentication</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>beforeware <span class="op">=</span> Beforeware(user_auth_before, skip<span class="op">=</span>[<span class="st">'/login'</span>, <span class="st">'/signup'</span>])</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>app, rt <span class="op">=</span> fast_app(before<span class="op">=</span>beforeware)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Use validation helpers</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> is_username_available(db, <span class="st">'new_user'</span>):</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Username is available for registration</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>That‚Äôs it! Your routes are now protected and users must authenticate to access them.</p>
</section>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This module provides comprehensive authentication features:</p>
<section id="core-functions" class="level3">
<h3 class="anchored" data-anchor-id="core-functions">Core Functions</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Function</th>
<th>Purpose</th>
<th>When to Use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#hash_password"><code>hash_password</code></a></td>
<td>Securely hash passwords with bcrypt</td>
<td>User registration/password updates</td>
</tr>
<tr class="even">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#verify_password"><code>verify_password</code></a></td>
<td>Check if password matches hash</td>
<td>User login</td>
</tr>
<tr class="odd">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#user_auth_before"><code>user_auth_before</code></a></td>
<td>Beforeware to protect routes</td>
<td>App initialization</td>
</tr>
<tr class="even">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#get_user_from_session"><code>get_user_from_session</code></a></td>
<td>Extract user data from session</td>
<td>Inside route handlers</td>
</tr>
<tr class="odd">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#create_auth_token"><code>create_auth_token</code></a></td>
<td>Generate secure tokens</td>
<td>Remember me/API auth</td>
</tr>
<tr class="even">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#verify_auth_token"><code>verify_auth_token</code></a></td>
<td>Validate tokens</td>
<td>Token-based auth</td>
</tr>
</tbody>
</table>
</section>
<section id="database-functions" class="level3">
<h3 class="anchored" data-anchor-id="database-functions">Database Functions</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Function</th>
<th>Purpose</th>
<th>When to Use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#init_auth_tables"><code>init_auth_tables</code></a></td>
<td>Create database tables and indexes</td>
<td>App startup</td>
</tr>
<tr class="even">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#create_user"><code>create_user</code></a></td>
<td>Register new user</td>
<td>User signup</td>
</tr>
<tr class="odd">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#get_user_by_id"><code>get_user_by_id</code></a></td>
<td>Fetch user by ID</td>
<td>User profile/admin</td>
</tr>
<tr class="even">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#get_user_by_email"><code>get_user_by_email</code></a></td>
<td>Fetch user by email</td>
<td>Login/verification</td>
</tr>
<tr class="odd">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#get_user_by_username"><code>get_user_by_username</code></a></td>
<td>Fetch user by username</td>
<td>Login/profile lookup</td>
</tr>
<tr class="even">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#update_user"><code>update_user</code></a></td>
<td>Update user attributes</td>
<td>Profile editing</td>
</tr>
<tr class="odd">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#delete_user"><code>delete_user</code></a></td>
<td>Remove user from database</td>
<td>Account deletion</td>
</tr>
</tbody>
</table>
</section>
<section id="helper-functions" class="level3">
<h3 class="anchored" data-anchor-id="helper-functions">Helper Functions</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Function</th>
<th>Purpose</th>
<th>When to Use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#authenticate_user"><code>authenticate_user</code></a></td>
<td>Verify credentials and return user</td>
<td>Login endpoint</td>
</tr>
<tr class="even">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#check_permission"><code>check_permission</code></a></td>
<td>Verify user has required role</td>
<td>Access control</td>
</tr>
<tr class="odd">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#track_login"><code>track_login</code></a></td>
<td>Record login events</td>
<td>Security/analytics</td>
</tr>
<tr class="even">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#is_username_available"><code>is_username_available</code></a></td>
<td>Check username uniqueness</td>
<td>Registration</td>
</tr>
<tr class="odd">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#is_email_available"><code>is_email_available</code></a></td>
<td>Check email uniqueness</td>
<td>Registration</td>
</tr>
<tr class="even">
<td><a href="https://LotsOfOrg.github.io/ship-kit/auth.html#validate_user_data"><code>validate_user_data</code></a></td>
<td>Validate registration data</td>
<td>Form validation</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="password-hashing" class="level2">
<h2 class="anchored" data-anchor-id="password-hashing">Password Hashing</h2>
<p>Launch Kit uses bcrypt for password hashing - the industry standard for secure password storage. Our implementation uses a cost factor of 12, providing excellent security while maintaining reasonable performance (~200ms per hash on modern hardware).</p>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L29" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="hash_password" class="level3">
<h3 class="anchored" data-anchor-id="hash_password">hash_password</h3>
<blockquote class="blockquote">
<pre><code> hash_password (password:str)</code></pre>
</blockquote>
<p><em>Hash a password using bcrypt with a cost factor of 12.</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>password</td>
<td>str</td>
<td>The password to hash</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>str</strong></td>
<td><strong>The hashed password</strong></td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Password Length Limitation
</div>
</div>
<div class="callout-body-container callout-body">
<p>bcrypt has a maximum password length of 72 bytes. Passwords longer than this are silently truncated. For applications requiring longer passwords, consider hashing with SHA-256 first:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hashlib</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>long_password <span class="op">=</span> <span class="st">"very_long_password"</span> <span class="op">*</span> <span class="dv">10</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Hash with SHA-256 first, then bcrypt</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>sha_hash <span class="op">=</span> hashlib.sha256(long_password.encode()).hexdigest()</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>final_hash <span class="op">=</span> hash_password(sha_hash)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L38" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="verify_password" class="level3">
<h3 class="anchored" data-anchor-id="verify_password">verify_password</h3>
<blockquote class="blockquote">
<pre><code> verify_password (password:str, hashed:str)</code></pre>
</blockquote>
<p><em>Verify a password against a bcrypt hash.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 38%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>password</td>
<td>str</td>
<td>The password to verify</td>
</tr>
<tr class="even">
<td>hashed</td>
<td>str</td>
<td>The hashed password to compare against</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>bool</strong></td>
<td><strong>True if password matches hash, False otherwise</strong></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="user-model" class="level2">
<h2 class="anchored" data-anchor-id="user-model">User Model</h2>
<p>Launch Kit provides a simple, dataclass-based User model that works seamlessly with FastHTML‚Äôs MiniDataAPI.</p>
<blockquote class="blockquote">
<p><strong>Note</strong>: While the User model is defined as a dataclass, fastlite returns query results as dictionaries for flexibility and performance. This is the expected behavior and aligns with fastlite‚Äôs design philosophy.</p>
</blockquote>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L54" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="user" class="level3">
<h3 class="anchored" data-anchor-id="user">User</h3>
<blockquote class="blockquote">
<pre><code> User (username:str, email:str, password_hash:str, role:str='user',
       is_active:bool=True, created_at:datetime.datetime=&lt;factory&gt;,
       updated_at:datetime.datetime=&lt;factory&gt;, id:Optional[int]=None)</code></pre>
</blockquote>
<p><em>User model for authentication.</em></p>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L67" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="init_auth_tables" class="level3">
<h3 class="anchored" data-anchor-id="init_auth_tables">init_auth_tables</h3>
<blockquote class="blockquote">
<pre><code> init_auth_tables (db_path:str='data.db')</code></pre>
</blockquote>
<p><em>Creates the users table with proper schema and indexes. Uses FastHTML‚Äôs MiniDataAPI for simple, transparent database operations.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>db_path</td>
<td>str</td>
<td>data.db</td>
<td>The path to the SQLite database file</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>Database</strong></td>
<td></td>
<td><strong>The FastHTML Database instance configured with the User table</strong></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="user-crud-operations" class="level2">
<h2 class="anchored" data-anchor-id="user-crud-operations">User CRUD Operations</h2>
<p>Simple, transparent database operations following MiniDataAPI patterns:</p>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L110" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="create_user" class="level3">
<h3 class="anchored" data-anchor-id="create_user">create_user</h3>
<blockquote class="blockquote">
<pre><code> create_user (db:apswutils.db.Database, username:str, email:str,
              password:str, role:str='user', table_name:str='user')</code></pre>
</blockquote>
<p><em>Create a new user in the database.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>db</td>
<td>Database</td>
<td></td>
<td>The FastHTML Database instance</td>
</tr>
<tr class="even">
<td>username</td>
<td>str</td>
<td></td>
<td>The unique username</td>
</tr>
<tr class="odd">
<td>email</td>
<td>str</td>
<td></td>
<td>The unique email address</td>
</tr>
<tr class="even">
<td>password</td>
<td>str</td>
<td></td>
<td>The plain text password</td>
</tr>
<tr class="odd">
<td>role</td>
<td>str</td>
<td>user</td>
<td>The user role</td>
</tr>
<tr class="even">
<td>table_name</td>
<td>str</td>
<td>user</td>
<td>The table name</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>Optional</strong></td>
<td></td>
<td><strong>The created user dict or None if user already exists</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L137" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_user_by_id" class="level3">
<h3 class="anchored" data-anchor-id="get_user_by_id">get_user_by_id</h3>
<blockquote class="blockquote">
<pre><code> get_user_by_id (db:apswutils.db.Database, user_id:int,
                 table_name:str='user')</code></pre>
</blockquote>
<p><em>Get user by ID.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>db</td>
<td>Database</td>
<td></td>
<td>The FastHTML Database instance</td>
</tr>
<tr class="even">
<td>user_id</td>
<td>int</td>
<td></td>
<td>The user ID</td>
</tr>
<tr class="odd">
<td>table_name</td>
<td>str</td>
<td>user</td>
<td>The table name</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>Optional</strong></td>
<td></td>
<td><strong>The user dict or None if not found</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L150" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_user_by_email" class="level3">
<h3 class="anchored" data-anchor-id="get_user_by_email">get_user_by_email</h3>
<blockquote class="blockquote">
<pre><code> get_user_by_email (db:apswutils.db.Database, email:str,
                    table_name:str='user')</code></pre>
</blockquote>
<p><em>Get user by email address.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>db</td>
<td>Database</td>
<td></td>
<td>The FastHTML Database instance</td>
</tr>
<tr class="even">
<td>email</td>
<td>str</td>
<td></td>
<td>The email address</td>
</tr>
<tr class="odd">
<td>table_name</td>
<td>str</td>
<td>user</td>
<td>The table name</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>Optional</strong></td>
<td></td>
<td><strong>The user dict or None if not found</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L161" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_user_by_username" class="level3">
<h3 class="anchored" data-anchor-id="get_user_by_username">get_user_by_username</h3>
<blockquote class="blockquote">
<pre><code> get_user_by_username (db:apswutils.db.Database, username:str,
                       table_name:str='user')</code></pre>
</blockquote>
<p><em>Get user by username.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>db</td>
<td>Database</td>
<td></td>
<td>The FastHTML Database instance</td>
</tr>
<tr class="even">
<td>username</td>
<td>str</td>
<td></td>
<td>The username</td>
</tr>
<tr class="odd">
<td>table_name</td>
<td>str</td>
<td>user</td>
<td>The table name</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>Optional</strong></td>
<td></td>
<td><strong>The user dict or None if not found</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L172" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="update_user" class="level3">
<h3 class="anchored" data-anchor-id="update_user">update_user</h3>
<blockquote class="blockquote">
<pre><code> update_user (db:apswutils.db.Database, user_id:int,
              table_name:str='user', **kwargs)</code></pre>
</blockquote>
<p><em>Update user attributes.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>db</td>
<td>Database</td>
<td></td>
<td>The FastHTML Database instance</td>
</tr>
<tr class="even">
<td>user_id</td>
<td>int</td>
<td></td>
<td>The user ID</td>
</tr>
<tr class="odd">
<td>table_name</td>
<td>str</td>
<td>user</td>
<td>The table name</td>
</tr>
<tr class="even">
<td>kwargs</td>
<td>VAR_KEYWORD</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>Optional</strong></td>
<td></td>
<td><strong>The updated user dict or None if not found</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L201" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="delete_user" class="level3">
<h3 class="anchored" data-anchor-id="delete_user">delete_user</h3>
<blockquote class="blockquote">
<pre><code> delete_user (db:apswutils.db.Database, user_id:int,
              table_name:str='user')</code></pre>
</blockquote>
<p><em>Delete a user from the database.</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>db</td>
<td>Database</td>
<td></td>
<td>The FastHTML Database instance</td>
</tr>
<tr class="even">
<td>user_id</td>
<td>int</td>
<td></td>
<td>The user ID</td>
</tr>
<tr class="odd">
<td>table_name</td>
<td>str</td>
<td>user</td>
<td>The table name</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>bool</strong></td>
<td></td>
<td><strong>True if deleted, False if not found</strong></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="authentication-helpers" class="level2">
<h2 class="anchored" data-anchor-id="authentication-helpers">Authentication Helpers</h2>
<p>Convenient functions for common authentication operations:</p>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L222" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="check_permission" class="level3">
<h3 class="anchored" data-anchor-id="check_permission">check_permission</h3>
<blockquote class="blockquote">
<pre><code> check_permission (user:__main__.User, required_role:str)</code></pre>
</blockquote>
<p>*Check if a user has the required role or higher.</p>
<p>Role hierarchy: - ‚Äòadmin‚Äô has all permissions - ‚Äòuser‚Äô has basic permissions - Custom roles can be added as needed*</p>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 38%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>user</td>
<td>User</td>
<td>The User object to check</td>
</tr>
<tr class="even">
<td>required_role</td>
<td>str</td>
<td>The required role</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>bool</strong></td>
<td><strong>True if user has permission, False otherwise</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L248" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="authenticate_user" class="level3">
<h3 class="anchored" data-anchor-id="authenticate_user">authenticate_user</h3>
<blockquote class="blockquote">
<pre><code> authenticate_user (db:apswutils.db.Database, username_or_email:str,
                    password:str, table_name:str='user')</code></pre>
</blockquote>
<p><em>Authenticate a user by username/email and password.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>db</td>
<td>Database</td>
<td></td>
<td>The FastHTML Database instance</td>
</tr>
<tr class="even">
<td>username_or_email</td>
<td>str</td>
<td></td>
<td>The username or email address</td>
</tr>
<tr class="odd">
<td>password</td>
<td>str</td>
<td></td>
<td>The plain text password</td>
</tr>
<tr class="even">
<td>table_name</td>
<td>str</td>
<td>user</td>
<td>The table name</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>Optional</strong></td>
<td></td>
<td><strong>The authenticated user dict or None if invalid credentials</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L277" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="track_login" class="level3">
<h3 class="anchored" data-anchor-id="track_login">track_login</h3>
<blockquote class="blockquote">
<pre><code> track_login (db:apswutils.db.Database, user_id:int,
              ip_address:Optional[str]=None,
              user_agent:Optional[str]=None, table_name:str='user_logins')</code></pre>
</blockquote>
<p>*Track user login for security and analytics using MiniDataAPI pattern.</p>
<p>Creates a login record with timestamp and metadata. Returns the created login record.*</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>db</td>
<td>Database</td>
<td></td>
<td>The FastHTML Database instance</td>
</tr>
<tr class="even">
<td>user_id</td>
<td>int</td>
<td></td>
<td>The user ID</td>
</tr>
<tr class="odd">
<td>ip_address</td>
<td>Optional</td>
<td>None</td>
<td>The IP address of the login</td>
</tr>
<tr class="even">
<td>user_agent</td>
<td>Optional</td>
<td>None</td>
<td>The user agent string</td>
</tr>
<tr class="odd">
<td>table_name</td>
<td>str</td>
<td>user_logins</td>
<td>The table name</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>Dict</strong></td>
<td></td>
<td><strong>The login record</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L268" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="userlogin" class="level3">
<h3 class="anchored" data-anchor-id="userlogin">UserLogin</h3>
<blockquote class="blockquote">
<pre><code> UserLogin (user_id:int, ip_address:Optional[str]=None,
            user_agent:Optional[str]=None,
            login_time:datetime.datetime=&lt;factory&gt;, id:Optional[int]=None)</code></pre>
</blockquote>
<p><em>Login tracking record for security and analytics.</em></p>
</section>
<section id="comparison-raw-sql-vs-minidataapi" class="level3">
<h3 class="anchored" data-anchor-id="comparison-raw-sql-vs-minidataapi">Comparison: Raw SQL vs MiniDataAPI</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 37%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th>Aspect</th>
<th>Current (Raw SQL)</th>
<th>Proposed (MiniDataAPI)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Table Creation</strong></td>
<td>Manual SQL with CREATE TABLE</td>
<td><code>db.create(UserLogin)</code></td>
</tr>
<tr class="even">
<td><strong>Data Insertion</strong></td>
<td>SQL INSERT with placeholders</td>
<td><code>logins.insert(login_data)</code></td>
</tr>
<tr class="odd">
<td><strong>Return Value</strong></td>
<td>None</td>
<td>Login record dict</td>
</tr>
<tr class="even">
<td><strong>Type Safety</strong></td>
<td>No type hints for data</td>
<td>Dataclass with types</td>
</tr>
<tr class="odd">
<td><strong>Consistency</strong></td>
<td>Different from other functions</td>
<td>Same pattern as User CRUD</td>
</tr>
<tr class="even">
<td><strong>Database Portability</strong></td>
<td>SQLite-specific syntax</td>
<td>Works across databases</td>
</tr>
<tr class="odd">
<td><strong>Foreign Keys</strong></td>
<td>Defined in CREATE TABLE</td>
<td>Need separate index creation</td>
</tr>
</tbody>
</table>
</section>
<section id="migration-considerations" class="level3">
<h3 class="anchored" data-anchor-id="migration-considerations">Migration Considerations</h3>
<p>To migrate existing databases: 1. The table structure created by MiniDataAPI is compatible with the existing schema 2. Foreign key constraints would need to be added separately 3. Existing data would remain intact</p>
</section>
</section>
<section id="validation-helpers" class="level2">
<h2 class="anchored" data-anchor-id="validation-helpers">Validation Helpers</h2>
<p>Functions to ensure data integrity and check uniqueness:</p>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L306" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="is_username_available" class="level3">
<h3 class="anchored" data-anchor-id="is_username_available">is_username_available</h3>
<blockquote class="blockquote">
<pre><code> is_username_available (db:apswutils.db.Database, username:str,
                        table_name:str='user')</code></pre>
</blockquote>
<p><em>Check if username is available for registration.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>db</td>
<td>Database</td>
<td></td>
<td>The FastHTML Database instance</td>
</tr>
<tr class="even">
<td>username</td>
<td>str</td>
<td></td>
<td>The username to check</td>
</tr>
<tr class="odd">
<td>table_name</td>
<td>str</td>
<td>user</td>
<td>The table name</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>bool</strong></td>
<td></td>
<td><strong>True if username is available, False if taken</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L315" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="is_email_available" class="level3">
<h3 class="anchored" data-anchor-id="is_email_available">is_email_available</h3>
<blockquote class="blockquote">
<pre><code> is_email_available (db:apswutils.db.Database, email:str,
                     table_name:str='user')</code></pre>
</blockquote>
<p><em>Check if email is available for registration.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>db</td>
<td>Database</td>
<td></td>
<td>The FastHTML Database instance</td>
</tr>
<tr class="even">
<td>email</td>
<td>str</td>
<td></td>
<td>The email address to check</td>
</tr>
<tr class="odd">
<td>table_name</td>
<td>str</td>
<td>user</td>
<td>The table name</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>bool</strong></td>
<td></td>
<td><strong>True if email is available, False if taken</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L324" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="validate_user_data" class="level3">
<h3 class="anchored" data-anchor-id="validate_user_data">validate_user_data</h3>
<blockquote class="blockquote">
<pre><code> validate_user_data (username:str, email:str, password:str)</code></pre>
</blockquote>
<p><em>Validate user registration data.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 38%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>username</td>
<td>str</td>
<td>The username to validate</td>
</tr>
<tr class="even">
<td>email</td>
<td>str</td>
<td>The email address to validate</td>
</tr>
<tr class="odd">
<td>password</td>
<td>str</td>
<td>The password to validate</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>List</strong></td>
<td><strong>The list of validation errors (empty if valid)</strong></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="session-management" class="level2">
<h2 class="anchored" data-anchor-id="session-management">Session Management</h2>
<p>FastHTML uses server-side sessions to maintain authentication state. Launch Kit provides utilities to make session management simple and secure.</p>
<section id="protecting-routes-with-beforeware" class="level3">
<h3 class="anchored" data-anchor-id="protecting-routes-with-beforeware">Protecting Routes with Beforeware</h3>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L353" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="user_auth_before" class="level3">
<h3 class="anchored" data-anchor-id="user_auth_before">user_auth_before</h3>
<blockquote class="blockquote">
<pre><code> user_auth_before (req, sess, login_path='/login')</code></pre>
</blockquote>
<p>*Beforeware function to check authentication status.</p>
<p>Following FastHTML‚Äôs standard authentication pattern: - Sets req.scope[‚Äòauth‚Äô] for automatic injection in route handlers - Returns None if authenticated (continue processing) - Returns RedirectResponse if not authenticated*</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>req</td>
<td></td>
<td></td>
<td>The FastHTML Request object</td>
</tr>
<tr class="even">
<td>sess</td>
<td></td>
<td></td>
<td>The FastHTML Session object</td>
</tr>
<tr class="odd">
<td>login_path</td>
<td>str</td>
<td>/login</td>
<td>The login path</td>
</tr>
</tbody>
</table>
<p>The <a href="https://LotsOfOrg.github.io/ship-kit/auth.html#user_auth_before"><code>user_auth_before</code></a> follows FastHTML‚Äôs recommended authentication pattern. It sets req.scope[‚Äòauth‚Äô] for automatic injection in route handlers.</p>
</section>
<section id="session-schema" class="level3">
<h3 class="anchored" data-anchor-id="session-schema">Session Schema</h3>
<p>Launch Kit uses a consistent session schema: - <code>sess['auth']</code>: Boolean or auth token - indicates if user is authenticated - <code>sess['user']</code>: Dict with user data (id, username, email, role, etc.)</p>
<p>This separation allows flexibility while maintaining consistency:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># During login:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>sess[<span class="st">'auth'</span>] <span class="op">=</span> <span class="va">True</span>  <span class="co"># or sess['auth'] = create_auth_token(user['id'])</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>sess[<span class="st">'user'</span>] <span class="op">=</span> {</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'id'</span>: user[<span class="st">'id'</span>],</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'username'</span>: user[<span class="st">'username'</span>],</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'email'</span>: user[<span class="st">'email'</span>],</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'role'</span>: user[<span class="st">'role'</span>]</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Usage:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>beforeware <span class="op">=</span> Beforeware(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    user_auth_before,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    skip<span class="op">=</span>[<span class="st">'/login'</span>, <span class="st">'/signup'</span>, <span class="st">'/static/.*'</span>]</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Or with a custom login path like /auth/login:</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> auth_custom_login(req, sess):</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> user_auth_before(req, sess, login_path<span class="op">=</span><span class="st">'/auth/login'</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>beforeware <span class="op">=</span> Beforeware(</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    auth_custom_login,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    skip<span class="op">=</span>[<span class="st">'/auth/login'</span>, <span class="st">'/auth/signup'</span>, <span class="st">'/static/.*'</span>]</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L371" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_user_from_session" class="level3">
<h3 class="anchored" data-anchor-id="get_user_from_session">get_user_from_session</h3>
<blockquote class="blockquote">
<pre><code> get_user_from_session (sess)</code></pre>
</blockquote>
<p><em>Extract user data dictionary from session.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 38%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>sess</td>
<td></td>
<td>The FastHTML Session object</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>Optional</strong></td>
<td><strong>The user data dict or None if not authenticated</strong></td>
</tr>
</tbody>
</table>
<blockquote class="blockquote">
<p>Note: With FastHTML‚Äôs authentication pattern, you can also access auth status via the ‚Äòauth‚Äô parameter in route handlers.</p>
</blockquote>
</section>
<section id="working-with-user-sessions" class="level3">
<h3 class="anchored" data-anchor-id="working-with-user-sessions">Working with User Sessions</h3>
<div id="cell-36" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fasthtml.common <span class="im">import</span> <span class="op">*</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ship_kit.auth <span class="im">import</span> user_auth_before</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure authentication beforeware</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>beforeware <span class="op">=</span> Beforeware(</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    user_auth_before,  <span class="co"># Uses default /login path</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    skip<span class="op">=</span>[</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'/login'</span>,      <span class="co"># Don't require auth for login page</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'/signup'</span>,     <span class="co"># Don't require auth for signup</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'/static/.*'</span>,  <span class="co"># Static files don't need auth</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        <span class="vs">r'</span><span class="dv">.</span><span class="op">*</span><span class="ch">\.</span><span class="vs">css'</span>,    <span class="co"># CSS files</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        <span class="vs">r'</span><span class="dv">.</span><span class="op">*</span><span class="ch">\.</span><span class="vs">js'</span>      <span class="co"># JavaScript files</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Or with custom login path:</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> auth_custom_login(req, sess):</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> user_auth_before(req, sess, login_path<span class="op">=</span><span class="st">'/auth/login'</span>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>beforeware <span class="op">=</span> Beforeware(</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    auth_custom_login,</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    skip<span class="op">=</span>[<span class="st">'/auth/login'</span>, <span class="st">'/auth/signup'</span>, <span class="st">'/static/.*'</span>]</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Create app with authentication</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>app, rt <span class="op">=</span> fast_app(before<span class="op">=</span>beforeware)</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="co"># This route is protected - redirects to login if not authenticated</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/'</span>)</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get(auth):  <span class="co"># auth is automatically injected from req.scope['auth']</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> H1(<span class="ss">f"Welcome! You are </span><span class="sc">{</span><span class="st">'authenticated'</span> <span class="cf">if</span> auth <span class="cf">else</span> <span class="st">'not authenticated'</span><span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="authentication-tokens" class="level2">
<h2 class="anchored" data-anchor-id="authentication-tokens">Authentication Tokens</h2>
<p>Tokens enable stateless authentication for APIs and ‚Äúremember me‚Äù functionality. Launch Kit provides simple utilities for secure token generation and verification.</p>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L380" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="create_auth_token" class="level3">
<h3 class="anchored" data-anchor-id="create_auth_token">create_auth_token</h3>
<blockquote class="blockquote">
<pre><code> create_auth_token (user_id:int)</code></pre>
</blockquote>
<p><em>Create a secure authentication token for a user.</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>user_id</td>
<td>int</td>
<td>The user ID</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>str</strong></td>
<td><strong>The authentication token</strong></td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Token Storage
</div>
</div>
<div class="callout-body-container callout-body">
<p>In production, you‚Äôd store this token in your database with an expiration date and associate it with the user.</p>
</div>
</div>
<hr>
<p><a href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/auth.py#L389" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="verify_auth_token" class="level3">
<h3 class="anchored" data-anchor-id="verify_auth_token">verify_auth_token</h3>
<blockquote class="blockquote">
<pre><code> verify_auth_token (token:str)</code></pre>
</blockquote>
<p><em>Verify an authentication token and return the user ID.</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>token</td>
<td>str</td>
<td>The authentication token</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>Optional</strong></td>
<td><strong>The user ID or None if invalid</strong></td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Token Lookup
</div>
</div>
<div class="callout-body-container callout-body">
<p>In production, you‚Äôd look up this token in your database and check expiration.</p>
</div>
</div>
</section>
</section>
<section id="security-best-practices" class="level2">
<h2 class="anchored" data-anchor-id="security-best-practices">Security Best Practices</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Critical Security Guidelines
</div>
</div>
<div class="callout-body-container callout-body">
<p>Following these practices is essential for maintaining a secure authentication system.</p>
</div>
</div>
<section id="password-security" class="level3">
<h3 class="anchored" data-anchor-id="password-security">üîê Password Security</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Practice</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Minimum Length</strong></td>
<td>Enforce 12+ characters</td>
</tr>
<tr class="even">
<td><strong>Complexity</strong></td>
<td>Require mixed case, numbers, symbols</td>
</tr>
<tr class="odd">
<td><strong>Common Passwords</strong></td>
<td>Check against haveibeenpwned.com</td>
</tr>
<tr class="even">
<td><strong>Password History</strong></td>
<td>Prevent reuse of last 5 passwords</td>
</tr>
<tr class="odd">
<td><strong>Account Lockout</strong></td>
<td>Lock after 5 failed attempts</td>
</tr>
</tbody>
</table>
</section>
<section id="session-security" class="level3">
<h3 class="anchored" data-anchor-id="session-security">üç™ Session Security</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Practice</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Secure Cookies</strong></td>
<td><code>secure=True, httponly=True, samesite='Lax'</code></td>
</tr>
<tr class="even">
<td><strong>Session Timeout</strong></td>
<td>30 min idle, 12 hour absolute</td>
</tr>
<tr class="odd">
<td><strong>Session Rotation</strong></td>
<td>New ID after login</td>
</tr>
<tr class="even">
<td><strong>CSRF Protection</strong></td>
<td>Use CSRF tokens for state changes</td>
</tr>
</tbody>
</table>
</section>
<section id="token-security" class="level3">
<h3 class="anchored" data-anchor-id="token-security">üé´ Token Security</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Practice</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Storage</strong></td>
<td>Hash tokens before storing</td>
</tr>
<tr class="even">
<td><strong>Expiration</strong></td>
<td>30 days for remember me</td>
</tr>
<tr class="odd">
<td><strong>Rotation</strong></td>
<td>New token on each use</td>
</tr>
<tr class="even">
<td><strong>Revocation</strong></td>
<td>Allow users to revoke all tokens</td>
</tr>
</tbody>
</table>
</section>
<section id="general-security" class="level3">
<h3 class="anchored" data-anchor-id="general-security">üåê General Security</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Practice</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>HTTPS</strong></td>
<td>Enforce TLS 1.2+ everywhere</td>
</tr>
<tr class="even">
<td><strong>Rate Limiting</strong></td>
<td>5 attempts per minute</td>
</tr>
<tr class="odd">
<td><strong>Audit Logging</strong></td>
<td>Log all auth events</td>
</tr>
<tr class="even">
<td><strong>2FA</strong></td>
<td>Support TOTP/WebAuthn</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="complete-database-example" class="level2">
<h2 class="anchored" data-anchor-id="complete-database-example">Complete Database Example</h2>
<p>Here‚Äôs how to use the User model and database functions together:</p>
<div id="cell-44" class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ship_kit.auth <span class="im">import</span> <span class="op">*</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fasthtml.common <span class="im">import</span> <span class="op">*</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize database</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> init_auth_tables(<span class="st">'app.db'</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create FastHTML app with auth</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>beforeware <span class="op">=</span> Beforeware(</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    user_auth_before,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    skip<span class="op">=</span>[<span class="st">'/login'</span>, <span class="st">'/signup'</span>, <span class="st">'/'</span>]</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>app, rt <span class="op">=</span> fast_app(before<span class="op">=</span>beforeware)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/'</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get():</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Div(</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>        H1(<span class="st">'Welcome to Ship Kit Auth Demo'</span>),</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        A(<span class="st">'Sign Up'</span>, href<span class="op">=</span><span class="st">'/signup'</span>),</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">' | '</span>,</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>        A(<span class="st">'Login'</span>, href<span class="op">=</span><span class="st">'/login'</span>)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/signup'</span>)</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get():</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Div(</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>        H2(<span class="st">'Sign Up'</span>),</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>        Form(</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>            Input(name<span class="op">=</span><span class="st">'username'</span>, placeholder<span class="op">=</span><span class="st">'Username'</span>, required<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>            Input(name<span class="op">=</span><span class="st">'email'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'email'</span>, placeholder<span class="op">=</span><span class="st">'Email'</span>, required<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>            Input(name<span class="op">=</span><span class="st">'password'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'password'</span>, placeholder<span class="op">=</span><span class="st">'Password'</span>, required<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>            Button(<span class="st">'Sign Up'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'submit'</span>),</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>            method<span class="op">=</span><span class="st">'post'</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/signup'</span>)</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> post(username: <span class="bu">str</span>, email: <span class="bu">str</span>, password: <span class="bu">str</span>):</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate input</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>    errors <span class="op">=</span> validate_user_data(username, email, password)</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> errors:</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Div(</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>[P(error, style<span class="op">=</span><span class="st">'color: red'</span>) <span class="cf">for</span> error <span class="kw">in</span> errors],</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>            get()</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check availability</span></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> is_username_available(db, username):</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Div(P(<span class="st">'Username already taken'</span>, style<span class="op">=</span><span class="st">'color: red'</span>), get())</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> is_email_available(db, email):</span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Div(P(<span class="st">'Email already registered'</span>, style<span class="op">=</span><span class="st">'color: red'</span>), get())</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create user</span></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>    user <span class="op">=</span> create_user(db, username, email, password)</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> user:</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Redirect(<span class="st">'/login'</span>)</span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Div(P(<span class="st">'Registration failed'</span>, style<span class="op">=</span><span class="st">'color: red'</span>), get())</span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/login'</span>)</span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get():</span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Div(</span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a>        H2(<span class="st">'Login'</span>),</span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a>        Form(</span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a>            Input(name<span class="op">=</span><span class="st">'username_or_email'</span>, placeholder<span class="op">=</span><span class="st">'Username or Email'</span>, required<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a>            Input(name<span class="op">=</span><span class="st">'password'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'password'</span>, placeholder<span class="op">=</span><span class="st">'Password'</span>, required<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a>            Button(<span class="st">'Login'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'submit'</span>),</span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a>            method<span class="op">=</span><span class="st">'post'</span></span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/login'</span>)</span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> post(username_or_email: <span class="bu">str</span>, password: <span class="bu">str</span>, sess, req):</span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Authenticate user</span></span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a>    user <span class="op">=</span> authenticate_user(db, username_or_email, password)</span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> user:</span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set session</span></span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a>        sess[<span class="st">'auth'</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a>        sess[<span class="st">'user'</span>] <span class="op">=</span> {<span class="st">'id'</span>: user[<span class="st">'id'</span>], <span class="st">'username'</span>: user[<span class="st">'username'</span>], <span class="st">'email'</span>: user[<span class="st">'email'</span>]}</span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Track login (now returns a dictionary with login details)</span></span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a>        ip <span class="op">=</span> req.headers.get(<span class="st">'x-forwarded-for'</span>, req.client.host)</span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a>        user_agent <span class="op">=</span> req.headers.get(<span class="st">'user-agent'</span>)</span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true" tabindex="-1"></a>        login_record <span class="op">=</span> track_login(db, user[<span class="st">'id'</span>], ip, user_agent)</span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true" tabindex="-1"></a>        <span class="co"># You can use the login_record if needed, e.g. for analytics</span></span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true" tabindex="-1"></a>        <span class="co"># login_record contains: id, user_id, ip_address, user_agent, login_time</span></span>
<span id="cb27-88"><a href="#cb27-88" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-89"><a href="#cb27-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Redirect(<span class="st">'/dashboard'</span>)</span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Div(P(<span class="st">'Invalid credentials'</span>, style<span class="op">=</span><span class="st">'color: red'</span>), get())</span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/dashboard'</span>)</span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get(auth, sess):</span>
<span id="cb27-95"><a href="#cb27-95" aria-hidden="true" tabindex="-1"></a>    user_data <span class="op">=</span> get_user_from_session(sess)</span>
<span id="cb27-96"><a href="#cb27-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> user_data:</span>
<span id="cb27-97"><a href="#cb27-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Redirect(<span class="st">'/login'</span>)</span>
<span id="cb27-98"><a href="#cb27-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-99"><a href="#cb27-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Div(</span>
<span id="cb27-100"><a href="#cb27-100" aria-hidden="true" tabindex="-1"></a>        H2(<span class="ss">f"Welcome, </span><span class="sc">{</span>user_data[<span class="st">'username'</span>]<span class="sc">}</span><span class="ss">!"</span>),</span>
<span id="cb27-101"><a href="#cb27-101" aria-hidden="true" tabindex="-1"></a>        P(<span class="ss">f"Email: </span><span class="sc">{</span>user_data[<span class="st">'email'</span>]<span class="sc">}</span><span class="ss">"</span>),</span>
<span id="cb27-102"><a href="#cb27-102" aria-hidden="true" tabindex="-1"></a>        A(<span class="st">'Logout'</span>, href<span class="op">=</span><span class="st">'/logout'</span>)</span>
<span id="cb27-103"><a href="#cb27-103" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-104"><a href="#cb27-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-105"><a href="#cb27-105" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/logout'</span>)</span>
<span id="cb27-106"><a href="#cb27-106" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get(sess):</span>
<span id="cb27-107"><a href="#cb27-107" aria-hidden="true" tabindex="-1"></a>    sess.clear()</span>
<span id="cb27-108"><a href="#cb27-108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Redirect(<span class="st">'/'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="database-tests" class="level2">
<h2 class="anchored" data-anchor-id="database-tests">Database Tests</h2>
<p>Testing the User model and database operations:</p>
<section id="quick-example" class="level3">
<h3 class="anchored" data-anchor-id="quick-example">Quick Example</h3>
</section>
<section id="complete-loginsignup-example" class="level3">
<h3 class="anchored" data-anchor-id="complete-loginsignup-example">Complete Login/Signup Example</h3>
<p>Here‚Äôs how to implement a complete authentication flow:</p>
<div id="cell-48" class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fasthtml.common <span class="im">import</span> <span class="op">*</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ship_kit.auth <span class="im">import</span> hash_password, verify_password</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize FastHTML app</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>app, rt <span class="op">=</span> fast_app()</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated user database</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>users <span class="op">=</span> {}</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/signup'</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> post(email: <span class="bu">str</span>, password: <span class="bu">str</span>):</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if user exists</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> email <span class="kw">in</span> users:</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"User already exists"</span>, <span class="dv">400</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create new user with hashed password</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    users[email] <span class="op">=</span> {</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'email'</span>: email,</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'password'</span>: hash_password(password)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"Signup successful! Please login."</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/login'</span>) </span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> post(email: <span class="bu">str</span>, password: <span class="bu">str</span>, sess):</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get user from database</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    user <span class="op">=</span> users.get(email)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> user <span class="kw">and</span> verify_password(password, user[<span class="st">'password'</span>]):</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set session authentication</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>        sess[<span class="st">'auth'</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>        sess[<span class="st">'user_id'</span>] <span class="op">=</span> email</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Redirect(<span class="st">'/'</span>)</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"Invalid credentials"</span>, <span class="dv">401</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-49" class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># User registration</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>user_password <span class="op">=</span> <span class="st">"MySecureP@ssw0rd!"</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>hashed_password <span class="op">=</span> hash_password(user_password)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Store this in database: </span><span class="sc">{</span>hashed_password[:<span class="dv">20</span>]<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># User login</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>login_attempt <span class="op">=</span> <span class="st">"MySecureP@ssw0rd!"</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> verify_password(login_attempt, hashed_password):</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"‚úÖ Login successful!"</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"‚ùå Invalid password"</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Wrong password attempt</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> verify_password(<span class="st">"wrong_password"</span>, hashed_password):</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"‚ùå Invalid credentials rejected"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Store this in database: $2b$12$J7K88iTYaU2pD...
‚úÖ Login successful!
‚ùå Invalid credentials rejected</code></pre>
</div>
</div>
</section>
<section id="token-usage-example" class="level3">
<h3 class="anchored" data-anchor-id="token-usage-example">Token Usage Example</h3>
</section>
<section id="remember-me-implementation" class="level3">
<h3 class="anchored" data-anchor-id="remember-me-implementation">Remember Me Implementation</h3>
<p>Here‚Äôs how to implement ‚Äúremember me‚Äù functionality using tokens:</p>
<div id="cell-52" class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fasthtml.common <span class="im">import</span> <span class="op">*</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ship_kit.auth <span class="im">import</span> <span class="op">*</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize app</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>app, rt <span class="op">=</span> fast_app()</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper functions (would be in your database module)</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_user_by_email(email): </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fetch from database</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> store_remember_token(user_id, token, days): </span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store token with expiration in database</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_token_valid_in_db(token): </span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check token validity in database</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/login'</span>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> post(email: <span class="bu">str</span>, password: <span class="bu">str</span>, remember_me: <span class="bu">bool</span>, sess, resp):</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    user <span class="op">=</span> get_user_by_email(email)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> user <span class="kw">and</span> verify_password(password, user[<span class="st">'password'</span>]):</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set session auth</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>        sess[<span class="st">'auth'</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>        sess[<span class="st">'user_id'</span>] <span class="op">=</span> user[<span class="st">'id'</span>]</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If remember me is checked, create a token</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> remember_me:</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>            token <span class="op">=</span> create_auth_token(user[<span class="st">'id'</span>])</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Store token in database with expiration</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>            store_remember_token(user[<span class="st">'id'</span>], token, days<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Set cookie</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>            resp.set_cookie(<span class="st">'remember_token'</span>, token, max_age<span class="op">=</span><span class="dv">30</span><span class="op">*</span><span class="dv">24</span><span class="op">*</span><span class="dv">60</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Redirect(<span class="st">'/'</span>)</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"Invalid credentials"</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/'</span>)</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get(sess, req):</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check session first</span></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> sess.get(<span class="st">'auth'</span>):</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Welcome back!"</span></span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check remember me token</span></span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>    token <span class="op">=</span> req.cookies.get(<span class="st">'remember_token'</span>)</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> token:</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>        user_id <span class="op">=</span> verify_auth_token(token)</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> user_id <span class="kw">and</span> is_token_valid_in_db(token):</span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Restore session</span></span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>            sess[<span class="st">'auth'</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>            sess[<span class="st">'user_id'</span>] <span class="op">=</span> user_id</span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"Welcome back (remembered)!"</span></span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Redirect(<span class="st">'/login'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-53" class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a token for user 42</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>user_id <span class="op">=</span> <span class="dv">42</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>token <span class="op">=</span> create_auth_token(user_id)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Generated token: </span><span class="sc">{</span>token[:<span class="dv">20</span>]<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Later, verify the token</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>verified_user_id <span class="op">=</span> verify_auth_token(token)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> verified_user_id:</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"‚úÖ Valid token for user </span><span class="sc">{</span>verified_user_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"‚ùå Invalid or expired token"</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Invalid tokens return None</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> verify_auth_token(<span class="st">"tampered_token"</span>) <span class="kw">is</span> <span class="va">None</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"‚ùå Tampered tokens are rejected"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generated token: 42:l97Cko11shUwHASMC...
‚úÖ Valid token for user 42
‚ùå Tampered tokens are rejected</code></pre>
</div>
</div>
</section>
</section>
<section id="complete-example-interactive-demo" class="level2">
<h2 class="anchored" data-anchor-id="complete-example-interactive-demo">Complete Example: Interactive Demo</h2>
<p>Here‚Äôs a complete FastHTML application demonstrating all authentication features. Run it right here in the notebook!</p>
<div id="cell-55" class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fasthtml.common <span class="im">import</span> <span class="op">*</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ship_kit.auth <span class="im">import</span> <span class="op">*</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated database</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>users_db <span class="op">=</span> {<span class="st">'test@example.com'</span>: {<span class="st">'id'</span>: <span class="dv">1</span>, <span class="st">'email'</span>: <span class="st">'test@example.com'</span>, <span class="st">'password'</span>: hash_password(<span class="st">'password123'</span>)}}</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure authentication with custom login path</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a wrapper function instead of using partial</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> auth_with_custom_login(req, sess):</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> user_auth_before(req, sess, login_path<span class="op">=</span><span class="st">'/auth/login'</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>beforeware <span class="op">=</span> Beforeware(</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    auth_with_custom_login,</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    skip<span class="op">=</span>[<span class="vs">r'/auth/</span><span class="dv">.</span><span class="op">*</span><span class="vs">'</span>, <span class="vs">r'/public/</span><span class="dv">.</span><span class="op">*</span><span class="vs">'</span>, <span class="st">'/'</span>]</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>app, rt <span class="op">=</span> fast_app(before<span class="op">=</span>beforeware)</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Public home page</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/'</span>)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get(): </span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Div(</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>        H1(<span class="st">'Welcome to SecureApp'</span>),</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>        P(<span class="st">'A demo of Ship Kit authentication'</span>),</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>        A(<span class="st">'Login'</span>, href<span class="op">=</span><span class="st">'/auth/login'</span>, cls<span class="op">=</span><span class="st">'button'</span>),</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>        A(<span class="st">'Protected Area'</span>, href<span class="op">=</span><span class="st">'/protected'</span>, cls<span class="op">=</span><span class="st">'button'</span>)</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Login page</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/auth/login'</span>)</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get():</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Div(</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>        H2(<span class="st">'Login'</span>),</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>        Form(</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>            Input(name<span class="op">=</span><span class="st">'email'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'email'</span>, placeholder<span class="op">=</span><span class="st">'Email'</span>, required<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>            Input(name<span class="op">=</span><span class="st">'password'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'password'</span>, placeholder<span class="op">=</span><span class="st">'Password'</span>, required<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>            Button(<span class="st">'Login'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'submit'</span>),</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>            method<span class="op">=</span><span class="st">'post'</span></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Handle login</span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/auth/login'</span>)</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> post(email: <span class="bu">str</span>, password: <span class="bu">str</span>, sess):</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>    user <span class="op">=</span> users_db.get(email)</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> user <span class="kw">and</span> verify_password(password, user[<span class="st">'password'</span>]):</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>        sess[<span class="st">'auth'</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>        sess[<span class="st">'user'</span>] <span class="op">=</span> user</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Redirect(<span class="st">'/protected'</span>)</span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Div(P(<span class="st">'Invalid credentials'</span>, style<span class="op">=</span><span class="st">'color: red'</span>), get())</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Protected page</span></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/protected'</span>)</span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get(auth, sess):</span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>    user <span class="op">=</span> get_user_from_session(sess)</span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Div(</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a>        H2(<span class="ss">f"Welcome </span><span class="sc">{</span>user[<span class="st">'email'</span>]<span class="sc">}</span><span class="ss">!"</span>),</span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a>        P(<span class="st">'This is a protected page.'</span>),</span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a>        A(<span class="st">'Logout'</span>, href<span class="op">=</span><span class="st">'/auth/logout'</span>, cls<span class="op">=</span><span class="st">'button'</span>)</span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Logout</span></span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/auth/logout'</span>)</span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get(sess):</span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a>    sess.clear()</span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Redirect(<span class="st">'/'</span>)</span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Start the server in Jupyter [https://fastht.ml/docs/tutorials/jupyter_and_fasthtml.html]</span></span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fasthtml.jupyter <span class="im">import</span> JupyUvi</span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a>server <span class="op">=</span> JupyUvi(app)</span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Server running at http://localhost:8000"</span>)</span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Test credentials:"</span>)</span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"- Email: test@example.com"</span>)</span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"- Password: password123"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<script>
document.body.addEventListener('htmx:configRequest', (event) => {
    if(event.detail.path.includes('://')) return;
    htmx.config.selfRequestsOnly=false;
    event.detail.path = `${location.protocol}//${location.hostname}:8000${event.detail.path}`;
});
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Server running at http://localhost:8000

Test credentials:
- Email: test@example.com
- Password: password123</code></pre>
</div>
</div>
<div id="cell-56" class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View the app right here in the notebook by uncommenting the line below</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fasthtml.jupyter <span class="im">import</span> HTMX</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">#HTMX()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="automated-testing" class="level3">
<h3 class="anchored" data-anchor-id="automated-testing">Automated Testing</h3>
<p>You can also test the authentication flow programmatically:</p>
<div id="cell-58" class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> httpx</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Test the authentication flow</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> test_auth_flow():</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="cf">with</span> httpx.AsyncClient(base_url<span class="op">=</span><span class="st">"http://localhost:8000"</span>, follow_redirects<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> client:</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Testing authentication flow..."</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1. Try protected page (should redirect)</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>        resp <span class="op">=</span> <span class="cf">await</span> client.get(<span class="st">"/protected"</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> resp.status_code <span class="op">==</span> <span class="dv">303</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> resp.headers[<span class="st">'location'</span>] <span class="op">==</span> <span class="st">'/auth/login'</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"‚úì Protected page redirects to /auth/login"</span>)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 2. Login with valid credentials</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>        resp <span class="op">=</span> <span class="cf">await</span> client.post(<span class="st">"/auth/login"</span>, data<span class="op">=</span>{</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"email"</span>: <span class="st">"test@example.com"</span>,</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"password"</span>: <span class="st">"password123"</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> resp.status_code <span class="op">==</span> <span class="dv">303</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> resp.headers[<span class="st">'location'</span>] <span class="op">==</span> <span class="st">'/protected'</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"‚úì Login successful"</span>)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 3. Access protected page</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>        resp <span class="op">=</span> <span class="cf">await</span> client.get(<span class="st">"/protected"</span>, follow_redirects<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> <span class="st">"Welcome test@example.com"</span> <span class="kw">in</span> resp.text</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"‚úì Protected page accessible"</span>)</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 4. Logout</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>        resp <span class="op">=</span> <span class="cf">await</span> client.get(<span class="st">"/auth/logout"</span>)</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> resp.status_code <span class="op">==</span> <span class="dv">303</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"‚úì Logout successful"</span>)</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">‚úÖ All tests passed!"</span>)</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the tests</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> test_auth_flow()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Testing authentication flow...
‚úì Protected page redirects to /auth/login
‚úì Login successful
‚úì Protected page accessible
‚úì Logout successful

‚úÖ All tests passed!</code></pre>
</div>
</div>
</section>
<section id="manual-testing" class="level3">
<h3 class="anchored" data-anchor-id="manual-testing">Manual Testing</h3>
<p>You can test the app manually in a browser by visiting: - http://localhost:8000 - Home page - http://localhost:8000/protected - Will redirect to login - http://localhost:8000/auth/login - Login with test@example.com / password123</p>
<div id="cell-60" class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Stop the server gracefully</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: Always run this after testing to clean up otherwise there will be a dangling thread</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># https://fastht.ml/docs/tutorials/jupyter_and_fasthtml.html#graceful-shutdowns</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Stopping server..."</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>server.stop()</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"‚úì Server stopped gracefully"</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">üéâ All tests passed! Authentication utilities are working correctly with FastHTML."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Stopping server...
‚úì Server stopped gracefully

üéâ All tests passed! Authentication utilities are working correctly with FastHTML.</code></pre>
</div>
</div>
</section>
</section>
<section id="auth-tests" class="level2">
<h2 class="anchored" data-anchor-id="auth-tests">Auth Tests</h2>
</section>
<section id="performance-benchmarks" class="level2">
<h2 class="anchored" data-anchor-id="performance-benchmarks">Performance Benchmarks</h2>
<p>Understanding the performance characteristics of authentication operations is crucial for capacity planning.</p>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>Ship Kit‚Äôs authentication module provides a complete, secure foundation for FastHTML applications:</p>
<ul>
<li><strong>Simple API</strong> - Core authentication functions plus comprehensive database operations</li>
<li><strong>Database Integration</strong> - User model with FastHTML‚Äôs MiniDataAPI for transparent persistence</li>
<li><strong>Secure by Default</strong> - Industry-standard bcrypt hashing with sensible defaults</li>
<li><strong>FastHTML Native</strong> - Seamless integration with sessions, beforeware, and database patterns</li>
<li><strong>Production Ready</strong> - Battle-tested patterns with comprehensive security guidelines</li>
<li><strong>Flexible</strong> - Works for both traditional web apps and API authentication</li>
<li><strong>Complete Solution</strong> - From user registration to login tracking, all in one module</li>
</ul>
<section id="breaking-changes-in-v2.0" class="level3">
<h3 class="anchored" data-anchor-id="breaking-changes-in-v2.0">Breaking Changes in v2.0</h3>
<ul>
<li><strong>Consistent Session Schema</strong> - Always use <code>sess['auth']</code> for auth status and <code>sess['user']</code> for user data</li>
<li><strong>Simplified user_auth_before</strong> - Now explicitly documents return behavior and sets req.scope[‚Äòauth‚Äô]</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/LotsOfOrg\.github\.io\/ship-kit");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/LotsOfOrg/ship-kit/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>