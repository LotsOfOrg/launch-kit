# Permissions


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Imports and utils

## Quick Start

Ship Kit‚Äôs permissions module provides simple, transparent access
control for your FastHTML applications:

``` python
from ship_kit.permissions import *
from fasthtml.common import *

app, rt = fast_app()

# 1. Protect routes with simple functions
@rt("/admin")
def get(req, sess):
    if not require_role("admin", req, sess):
        return RedirectResponse('/login', status_code=303)
    return "Welcome to admin area!"

# 2. Or use decorators for cleaner code
@rt("/moderator/dashboard")
@role_required("moderator")
def get(req, sess):
    return "Moderator Dashboard"

# 3. Check granular permissions
@rt("/users/delete")
@permission_required("delete_users")
def post(req, sess):
    # Delete user logic
    pass

# 4. Manual permission checks for conditional UI
@rt("/api/sensitive")
def get(req, sess):
    if not require_permission("view_sensitive_data", req, sess):
        return JSONResponse({"error": "Forbidden"}, status_code=403)
    return {"data": "sensitive information"}
```

That‚Äôs it! Your routes are now protected with role-based access control.

## Overview

This module provides a complete RBAC (Role-Based Access Control) system:

### Core Functions

<table>
<colgroup>
<col style="width: 31%" />
<col style="width: 28%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr>
<th>Function</th>
<th>Purpose</th>
<th>When to Use</th>
</tr>
</thead>
<tbody>
<tr>
<td><a
href="https://LotsOfOrg.github.io/ship-kit/permissions.html#require_auth"><code>require_auth</code></a></td>
<td>Check if user is authenticated</td>
<td>Manual auth checks</td>
</tr>
<tr>
<td><a
href="https://LotsOfOrg.github.io/ship-kit/permissions.html#require_role"><code>require_role</code></a></td>
<td>Check if user has specific role</td>
<td>Manual role checks</td>
</tr>
<tr>
<td><a
href="https://LotsOfOrg.github.io/ship-kit/permissions.html#require_permission"><code>require_permission</code></a></td>
<td>Check if user has permission</td>
<td>Manual permission checks</td>
</tr>
</tbody>
</table>

### Decorators

<table style="width:100%;">
<colgroup>
<col style="width: 33%" />
<col style="width: 27%" />
<col style="width: 39%" />
</colgroup>
<thead>
<tr>
<th>Decorator</th>
<th>Purpose</th>
<th>When to Use</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@auth_required</code></td>
<td>Require authentication</td>
<td>Protect any authenticated route</td>
</tr>
<tr>
<td><code>@role_required</code></td>
<td>Require specific role</td>
<td>Admin/moderator areas</td>
</tr>
<tr>
<td><code>@permission_required</code></td>
<td>Require specific permission</td>
<td>Granular access control</td>
</tr>
</tbody>
</table>

### Permission Management

<table>
<colgroup>
<col style="width: 31%" />
<col style="width: 28%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr>
<th>Function</th>
<th>Purpose</th>
<th>When to Use</th>
</tr>
</thead>
<tbody>
<tr>
<td><a
href="https://LotsOfOrg.github.io/ship-kit/permissions.html#get_user_permissions"><code>get_user_permissions</code></a></td>
<td>Get all user permissions</td>
<td>Display user capabilities</td>
</tr>
<tr>
<td><a
href="https://LotsOfOrg.github.io/ship-kit/permissions.html#register_permission"><code>register_permission</code></a></td>
<td>Register new permission</td>
<td>Add custom permissions</td>
</tr>
<tr>
<td><a
href="https://LotsOfOrg.github.io/ship-kit/permissions.html#set_role_permissions"><code>set_role_permissions</code></a></td>
<td>Set permissions for role</td>
<td>Configure roles</td>
</tr>
<tr>
<td><a
href="https://LotsOfOrg.github.io/ship-kit/permissions.html#clear_permission_cache"><code>clear_permission_cache</code></a></td>
<td>Clear cached permissions</td>
<td>After role changes</td>
</tr>
</tbody>
</table>

## Default Configuration

Launch Kit provides sensible defaults for role hierarchy and
permissions:

## Core Permission Functions

Simple boolean functions for checking authentication, roles, and
permissions:

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/permissions.py#L63"
target="_blank" style="float:right; font-size:smaller">source</a>

### require_auth

>  require_auth (req, sess)

\*Check if user is authenticated.

This is the simplest permission check - just verifies that a user is
logged in.\*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>req</td>
<td></td>
<td>The FastHTML Request object</td>
</tr>
<tr>
<td>sess</td>
<td></td>
<td>The FastHTML Session object</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>bool</strong></td>
<td><strong>True if user is authenticated</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/permissions.py#L73"
target="_blank" style="float:right; font-size:smaller">source</a>

### check_role_hierarchy

>  check_role_hierarchy (user_role:Optional[str], required_role:str)

\*Check if user‚Äôs role meets or exceeds the required role in hierarchy.

Uses ROLE_HIERARCHY to determine if a user‚Äôs role has sufficient
privileges. For example, an ‚Äòadmin‚Äô can access ‚Äòmoderator‚Äô areas.\*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>user_role</td>
<td>Optional</td>
<td>The user‚Äôs current role</td>
</tr>
<tr>
<td>required_role</td>
<td>str</td>
<td>The required role</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>bool</strong></td>
<td><strong>True if user role &gt;= required role</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/permissions.py#L91"
target="_blank" style="float:right; font-size:smaller">source</a>

### require_role

>  require_role (role:str, req, sess)

\*Check if user has the required role or higher in the hierarchy.

Uses role hierarchy so admins can access moderator areas, etc.\*

<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 38%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>role</td>
<td>str</td>
<td>The required role</td>
</tr>
<tr>
<td>req</td>
<td></td>
<td>The FastHTML Request object</td>
</tr>
<tr>
<td>sess</td>
<td></td>
<td>The FastHTML Session object</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>bool</strong></td>
<td><strong>True if user has the required role or higher</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/permissions.py#L106"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_user_permissions

>  get_user_permissions (user:Dict[str,Any])

\*Get all permissions for a user based on their role.

Returns a set of permission strings. Admins get ‚Äô*‚Äô which means all
permissions.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>user</td>
<td>Dict</td>
<td>The user dictionary from session</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>Set</strong></td>
<td><strong>Set of permission strings</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/permissions.py#L122"
target="_blank" style="float:right; font-size:smaller">source</a>

### has_permission

>  has_permission (user:Dict[str,Any], permission:str)

\*Check if user has a specific permission.

Handles the special case where admins have ‚Äô*‚Äô meaning all permissions.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>user</td>
<td>Dict</td>
<td>The user dictionary</td>
</tr>
<tr>
<td>permission</td>
<td>str</td>
<td>The permission to check</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>bool</strong></td>
<td><strong>True if user has permission</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/permissions.py#L141"
target="_blank" style="float:right; font-size:smaller">source</a>

### require_permission

>  require_permission (permission:str, req, sess)

\*Check if user has a specific permission.

This is for granular permission checking beyond roles.\*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>permission</td>
<td>str</td>
<td>The required permission</td>
</tr>
<tr>
<td>req</td>
<td></td>
<td>The FastHTML Request object</td>
</tr>
<tr>
<td>sess</td>
<td></td>
<td>The FastHTML Session object</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>bool</strong></td>
<td><strong>True if user has permission</strong></td>
</tr>
</tbody>
</table>

## Permission Decorators

Decorators provide a clean way to protect FastHTML routes:

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/permissions.py#L156"
target="_blank" style="float:right; font-size:smaller">source</a>

### auth_required

>  auth_required (func:Callable)

\*Decorator that requires authentication for a route.

Redirects to /login if user is not authenticated. Works with FastHTML
route functions that accept req and sess parameters.

Example: @rt(‚Äò/dashboard‚Äô) @auth_required def get(req, sess): return
‚ÄúDashboard content‚Äù\*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>func</td>
<td>Callable</td>
<td>The route function to protect</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>Callable</strong></td>
<td><strong>The wrapped function</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/permissions.py#L179"
target="_blank" style="float:right; font-size:smaller">source</a>

### role_required

>  role_required (role:str)

\*Decorator that requires a specific role for a route.

Returns 403 Forbidden if user doesn‚Äôt have the required role.

Example: @rt(‚Äò/admin‚Äô) @role_required(‚Äòadmin‚Äô) def get(req, sess):
return ‚ÄúAdmin panel‚Äù\*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>role</td>
<td>str</td>
<td>The required role</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>Callable</strong></td>
<td><strong>Decorator function</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/permissions.py#L211"
target="_blank" style="float:right; font-size:smaller">source</a>

### permission_required

>  permission_required (permission:str)

\*Decorator that requires a specific permission for a route.

Returns 403 Forbidden if user doesn‚Äôt have the required permission.

Example: @rt(‚Äò/users/delete‚Äô) @permission_required(‚Äòdelete_users‚Äô) def
post(req, sess, user_id: int): \# Delete user logic pass\*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>permission</td>
<td>str</td>
<td>The required permission</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>Callable</strong></td>
<td><strong>Decorator function</strong></td>
</tr>
</tbody>
</table>

## Permission Management

Functions for managing and configuring permissions:

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/permissions.py#L244"
target="_blank" style="float:right; font-size:smaller">source</a>

### register_permission

>  register_permission (name:str, description:Optional[str]=None)

\*Register a new permission in the system.

This is optional but helps with documentation and validation.\*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>str</td>
<td></td>
<td>Permission identifier</td>
</tr>
<tr>
<td>description</td>
<td>Optional</td>
<td>None</td>
<td>Human-readable description</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>None</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/permissions.py#L255"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_permissions_for_role

>  get_permissions_for_role (role:str)

*Get all permissions assigned to a role.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>role</td>
<td>str</td>
<td>The role name</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>Set</strong></td>
<td><strong>Set of permissions</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/permissions.py#L261"
target="_blank" style="float:right; font-size:smaller">source</a>

### set_role_permissions

>  set_role_permissions (role:str, permissions:Union[Set[str],List[str]])

*Set permissions for a role, replacing any existing permissions.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>role</td>
<td>str</td>
<td>The role name</td>
</tr>
<tr>
<td>permissions</td>
<td>Union</td>
<td>Permissions to assign</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>None</strong></td>
<td></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/permissions.py#L268"
target="_blank" style="float:right; font-size:smaller">source</a>

### add_role_permission

>  add_role_permission (role:str, permission:str)

*Add a single permission to a role.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>role</td>
<td>str</td>
<td>The role name</td>
</tr>
<tr>
<td>permission</td>
<td>str</td>
<td>Permission to add</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>None</strong></td>
<td></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/permissions.py#L277"
target="_blank" style="float:right; font-size:smaller">source</a>

### remove_role_permission

>  remove_role_permission (role:str, permission:str)

*Remove a single permission from a role.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>role</td>
<td>str</td>
<td>The role name</td>
</tr>
<tr>
<td>permission</td>
<td>str</td>
<td>Permission to remove</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>None</strong></td>
<td></td>
</tr>
</tbody>
</table>

## Session Integration

Utilities for caching permissions in the session for performance:

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/permissions.py#L285"
target="_blank" style="float:right; font-size:smaller">source</a>

### clear_permission_cache

>  clear_permission_cache (sess)

\*Clear cached permissions from session.

Call this after changing a user‚Äôs role or permissions.\*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>sess</td>
<td></td>
<td>The FastHTML Session object</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>None</strong></td>
<td></td>
</tr>
</tbody>
</table>

## Examples

### Basic Authentication Protection

``` python
from fasthtml.common import *
from ship_kit.permissions import *

app, rt = fast_app()

# Simple authentication check
@rt('/dashboard')
@auth_required
def get(req, sess):
    user = get_user_from_session(sess)
    return Div(
        H1(f"Welcome {user['username']}!"),
        P("This is your dashboard.")
    )
```

### Role-Based Access Control

``` python
# Admin-only area
@rt('/admin')
@role_required('admin')
def get(req, sess):
    return Div(
        H1("Admin Panel"),
        P("Only administrators can see this.")
    )

# Moderator area (admins can also access)
@rt('/moderate')
@role_required('moderator')  
def get(req, sess):
    return Div(
        H1("Moderation Queue"),
        P("Moderators and admins can see this.")
    )
```

### Granular Permission Checks

``` python
# Check specific permission
@rt('/users/{user_id}/delete', methods=['POST'])
@permission_required('delete_users')
def delete_user(req, sess, user_id: int):
    # Delete user logic here
    return {"status": "deleted", "user_id": user_id}

# Manual permission check for conditional UI
@rt('/users/{user_id}')
@auth_required
def get(req, sess, user_id: int):
    user = get_user_from_session(sess)
    can_delete = has_permission(user, 'delete_users')
    
    return Div(
        H1(f"User Profile #{user_id}"),
        Button(
            "Delete User",
            hx_post=f"/users/{user_id}/delete",
            hx_confirm="Are you sure?"
        ) if can_delete else None
    )
```

### Custom Permission Configuration

``` python
# Register custom permissions
register_permission('export_data', 'Export system data to CSV')
register_permission('view_analytics', 'View analytics dashboard')

# Create a custom role
set_role_permissions('analyst', {
    'read_all_data',
    'view_analytics', 
    'export_data'
})

# Add permission to existing role
add_role_permission('moderator', 'view_analytics')

# Remove permission from role
remove_role_permission('user', 'delete_own_data')
```

### API Endpoints with Permissions

``` python
# JSON API with permission checks
@rt('/api/users')
def get(req, sess):
    if not require_permission('read_all_data', req, sess):
        return JSONResponse(
            {"error": "Forbidden", "message": "Insufficient permissions"},
            status_code=403
        )
    
    # Return user data
    return JSONResponse({"users": []})

# Using decorators with JSON responses
@rt('/api/admin/stats')
@role_required('admin')
def get(req, sess):
    # Admin-only statistics
    return JSONResponse({
        "total_users": 1000,
        "active_sessions": 42
    })
```

## Testing Permissions

### Interactive Demo

``` python
# Complete demo app showing all permission features
from fasthtml.common import *
from ship_kit.auth import user_auth_before
from ship_kit.permissions import *

# Configure auth beforeware
beforeware = Beforeware(
    user_auth_before,
    skip=['/login', '/public', '/']
)

app, rt = fast_app(before=beforeware)

# Mock user database
users = {
    'admin@example.com': {'id': 1, 'email': 'admin@example.com', 'role': 'admin'},
    'mod@example.com': {'id': 2, 'email': 'mod@example.com', 'role': 'moderator'},
    'user@example.com': {'id': 3, 'email': 'user@example.com', 'role': 'user'}
}

# Public home page
@rt('/')
def get():
    return Div(
        H1("Permissions Demo"),
        P("Test different user roles:"),
        Ul(
            Li("admin@example.com - Admin role"),
            Li("mod@example.com - Moderator role"),
            Li("user@example.com - User role")
        ),
        A("Login", href="/login", cls="button")
    )

# Login page
@rt('/login')
def get():
    return Div(
        H2("Login"),
        Form(
            Input(name="email", type="email", placeholder="Email", required=True),
            Button("Login", type="submit"),
            method="post"
        )
    )

@rt('/login', methods=['POST'])
async def post(req, sess):
    form = await req.form()
    email = form.get('email')
    if email in users:
        sess['auth'] = True
        sess['user'] = users[email]
        return RedirectResponse('/dashboard', status_code=303)
    return "Invalid email"

# User dashboard - requires authentication
@rt('/dashboard')
@auth_required
def get(req, sess):
    user = get_user_from_session(sess)
    permissions = get_user_permissions(user)
    
    return Div(
        H1(f"Welcome {user['email']}"),
        P(f"Role: {user['role']}"),
        H3("Your Permissions:"),
        Ul(*[Li(perm) for perm in sorted(permissions)]) if '*' not in permissions else P("All permissions"),
        H3("Test Areas:"),
        Ul(
            Li(A("Admin Area", href="/admin")),
            Li(A("Moderator Area", href="/moderate")),
            Li(A("Delete Users", href="/users/delete"))
        ),
        A("Logout", href="/logout")
    )

# Admin only area
@rt('/admin')
@role_required('admin')
def get(req, sess):
    return Div(
        H1("Admin Area"),
        P("Only admins can see this!"),
        A("Back to Dashboard", href="/dashboard")
    )

# Moderator area (admins can also access)
@rt('/moderate')
@role_required('moderator')
def get(req, sess):
    user = get_user_from_session(sess)
    return Div(
        H1("Moderator Area"),
        P(f"Welcome {user['role']}! Moderators and admins can see this."),
        A("Back to Dashboard", href="/dashboard")
    )

# Permission-based access
@rt('/users/delete')
@permission_required('delete_users')
def get(req, sess):
    return Div(
        H1("Delete Users"),
        P("This requires the 'delete_users' permission."),
        P("Only admins have this by default."),
        A("Back to Dashboard", href="/dashboard")
    )

# Logout
@rt('/logout')
def get(sess):
    sess.clear()
    return RedirectResponse('/', status_code=303)

# Run the demo
from fasthtml.jupyter import JupyUvi
server = JupyUvi(app)
```

``` python
# View the app right here in the notebook by uncommenting the line below
from fasthtml.jupyter import HTMX
# HTMX()
```

``` python
# Stop the server gracefully
# Note: Always run this after testing to clean up otherwise there will be a dangling thread
# https://fastht.ml/docs/tutorials/jupyter_and_fasthtml.html#graceful-shutdowns
print("Stopping server...")
server.stop()
```

    Stopping server...

## Best Practices

### 1. **Use Decorators for Clean Code**

``` python
# Good: Clean and declarative
@rt('/admin')
@role_required('admin')
def get(req, sess):
    return admin_panel()

# Avoid: Manual checks in every route
@rt('/admin')
def get(req, sess):
    if not require_role('admin', req, sess):
        return RedirectResponse('/login')  
    return admin_panel()
```

### 2. **Role Hierarchy for Flexibility**

``` python
# Admins automatically get access to moderator areas
@role_required('moderator')  # Admins can also access
```

### 3. **Granular Permissions for Sensitive Operations**

``` python
# Use specific permissions for dangerous operations
@permission_required('delete_all_data')  # More specific than @role_required('admin')
```

### 4. **Clear Permission Cache After Role Changes**

``` python
def promote_to_admin(user_id, sess):
    # Update user role in database
    update_user_role(user_id, 'admin')
    # Clear cached permissions
    clear_permission_cache(sess)
```

### 5. **Combine with Beforeware for Global Auth**

``` python
# Use beforeware for site-wide auth
beforeware = Beforeware(user_auth_before, skip=['/login', '/public'])

# Then use decorators for specific permissions
@role_required('admin')
```

## Security Considerations

### üîí Permission Design

<table>
<colgroup>
<col style="width: 38%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr>
<th>Practice</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Principle of Least Privilege</strong></td>
<td>Give users minimum required permissions</td>
</tr>
<tr>
<td><strong>Role Separation</strong></td>
<td>Don‚Äôt combine unrelated permissions</td>
</tr>
<tr>
<td><strong>Audit Trail</strong></td>
<td>Log permission changes and access attempts</td>
</tr>
<tr>
<td><strong>Regular Review</strong></td>
<td>Periodically review role assignments</td>
</tr>
</tbody>
</table>

### üõ°Ô∏è Implementation Security

<table>
<thead>
<tr>
<th>Practice</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Session Security</strong></td>
<td>Use secure session configuration</td>
</tr>
<tr>
<td><strong>CSRF Protection</strong></td>
<td>Verify state-changing operations</td>
</tr>
<tr>
<td><strong>Rate Limiting</strong></td>
<td>Limit permission check attempts</td>
</tr>
<tr>
<td><strong>Error Handling</strong></td>
<td>Don‚Äôt leak permission info in errors</td>
</tr>
</tbody>
</table>

## Summary

Ship Kit‚Äôs permissions module provides:

- **Simple API** - Boolean functions and clean decorators
- **Role Hierarchy** - Admins can access moderator areas automatically
- **Granular Permissions** - Beyond roles for specific operations
- **FastHTML Native** - Works seamlessly with req/sess patterns
- **Transparent** - No hidden middleware or magic
- **Flexible** - Easy to extend with custom roles and permissions
- **Performance** - Optional session caching for efficiency

The module follows Ship Kit‚Äôs philosophy of being simple, transparent,
and flexible while providing all the features needed for production
applications.

### Breaking Changes in v2.0

- **Simplified decorators** - Decorators now expect FastHTML standard
  function signatures (req, sess as first two parameters)
- \*\*Removed \_extract_req_sess\*\* - No more complex parameter
  extraction, decorators work with standard patterns only
