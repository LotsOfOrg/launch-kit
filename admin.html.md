# Admin Panel


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

``` python
__all__ = ['setup_admin_routes', 'admin_list_view', 'admin_form', 'admin_table', 
           'get_field_input', 'clean_form_data']
```

## Quick Start

Following FastHTML patterns with simple, composable utilities:

``` python
from ship_kit.admin import setup_admin_routes
from fasthtml.common import *

app, rt = fast_app()
db = Database('app.db')
products = db.create(Product, pk='id')

# Simple setup - just pass your table and router
setup_admin_routes(rt, 'products', products, Product)

# That's it! Routes are created at /admin/products/
```

## Core Functions

Simple, composable functions following FastHTML’s functional approach:

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/admin.py#L20"
target="_blank" style="float:right; font-size:smaller">source</a>

### setup_admin_routes

>  setup_admin_routes (rt, name:str, table, model_class:Type,
>                          path_prefix:str='/admin',
>                          auth_check:Optional[Callable]=None, per_page:int=25)

\*Setup admin routes for a model using standard FastHTML patterns.

This creates all CRUD routes following FastHTML conventions.\*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>rt</td>
<td></td>
<td></td>
<td>FastHTML router instance</td>
</tr>
<tr>
<td>name</td>
<td>str</td>
<td></td>
<td>Model name (e.g., ‘products’)</td>
</tr>
<tr>
<td>table</td>
<td></td>
<td></td>
<td>MiniDataAPI table</td>
</tr>
<tr>
<td>model_class</td>
<td>Type</td>
<td></td>
<td>Dataclass model</td>
</tr>
<tr>
<td>path_prefix</td>
<td>str</td>
<td>/admin</td>
<td>URL prefix</td>
</tr>
<tr>
<td>auth_check</td>
<td>Optional</td>
<td>None</td>
<td>Auth function</td>
</tr>
<tr>
<td>per_page</td>
<td>int</td>
<td>25</td>
<td>Items per page</td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/admin.py#L136"
target="_blank" style="float:right; font-size:smaller">source</a>

### admin_list_view

>  admin_list_view (name:str, items:List, page:int, total_pages:int,
>                       search:str='', base_path:str='')

\*Generate admin list view with table and pagination.

Simple, reusable component following FastHTML patterns.\*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>str</td>
<td></td>
<td>Model name</td>
</tr>
<tr>
<td>items</td>
<td>List</td>
<td></td>
<td>List of items</td>
</tr>
<tr>
<td>page</td>
<td>int</td>
<td></td>
<td>Current page</td>
</tr>
<tr>
<td>total_pages</td>
<td>int</td>
<td></td>
<td>Total pages</td>
</tr>
<tr>
<td>search</td>
<td>str</td>
<td></td>
<td>Search query</td>
</tr>
<tr>
<td>base_path</td>
<td>str</td>
<td></td>
<td>Base URL path</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>FT</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/admin.py#L172"
target="_blank" style="float:right; font-size:smaller">source</a>

### admin_table

>  admin_table (items:List, base_path:str='')

\*Generate admin table component.

Simple table component that works with any list of dict-like objects.\*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>items</td>
<td>List</td>
<td></td>
<td>List of items to display</td>
</tr>
<tr>
<td>base_path</td>
<td>str</td>
<td></td>
<td>Base URL path for actions</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>FT</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/admin.py#L237"
target="_blank" style="float:right; font-size:smaller">source</a>

### admin_form

>  admin_form (model_class:Type, data:Optional[Dict]=None, action:str='',
>                  title:str='Form', error:Optional[str]=None)

\*Generate admin form from dataclass.

Simple form generator that creates appropriate inputs for each field
type.\*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>model_class</td>
<td>Type</td>
<td></td>
<td>Dataclass model</td>
</tr>
<tr>
<td>data</td>
<td>Optional</td>
<td>None</td>
<td>Current data (for editing)</td>
</tr>
<tr>
<td>action</td>
<td>str</td>
<td></td>
<td>Form action URL</td>
</tr>
<tr>
<td>title</td>
<td>str</td>
<td>Form</td>
<td>Form title</td>
</tr>
<tr>
<td>error</td>
<td>Optional</td>
<td>None</td>
<td>Error message</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>FT</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/admin.py#L280"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_field_input

>  get_field_input (name:str, field_type:Type, value:Any='')

\*Get appropriate input component for field type.

Simple function that maps Python types to HTML input types.\*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>str</td>
<td></td>
<td>Field name</td>
</tr>
<tr>
<td>field_type</td>
<td>Type</td>
<td></td>
<td>Field type</td>
</tr>
<tr>
<td>value</td>
<td>Any</td>
<td></td>
<td>Current value</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>FT</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/LotsOfOrg/ship-kit/blob/main/ship_kit/admin.py#L334"
target="_blank" style="float:right; font-size:smaller">source</a>

### clean_form_data

>  clean_form_data (model_class:Type, form_data:Dict)

\*Clean and convert form data to appropriate types.

Simple type conversion from HTML form strings to Python types.\*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>model_class</td>
<td>Type</td>
<td>Dataclass model</td>
</tr>
<tr>
<td>form_data</td>
<td>Dict</td>
<td>Raw form data</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>Dict</strong></td>
<td></td>
</tr>
</tbody>
</table>

## Helper Functions

## Usage Examples

### Simple Setup

``` python
from fasthtml.common import *
from ship_kit.admin import setup_admin_routes
from dataclasses import dataclass
from typing import Optional

# Standard FastHTML setup
app, rt = fast_app()
db = Database('app.db')

@dataclass
class Product:
    name: str
    price: float
    category: str
    is_active: bool = True
    id: Optional[int] = None

products = db.create(Product, pk='id')

# One line setup
setup_admin_routes(rt, 'products', products, Product)

# That's it! Routes created:
# /admin/products/ - list view
# /admin/products/new - create form
# /admin/products/{id}/edit - edit form
# /admin/products/{id}/delete - delete handler
```

### Custom Components

``` python
# Use individual components for custom layouts
from ship_kit.admin import admin_table, admin_form, get_field_input

@rt('/custom-admin')
def custom_admin(req, sess):
    products = products_table()  # Your table
    
    return Container(
        H1("Custom Admin Dashboard"),
        admin_table(products, '/admin/products')
    )

@rt('/custom-form')
def custom_form(req, sess):
    return admin_form(Product, action='/save-product', title='Add Product')
```

``` python
# Setup admin for multiple models
@dataclass
class Category:
    name: str
    description: str = ""
    id: Optional[int] = None

@dataclass
class Order:
    customer_email: str
    total: float
    status: str = "pending"
    created_at: datetime = field(default_factory=datetime.utcnow)
    id: Optional[int] = None

# Create tables
categories = db.create(Category, pk='id')
orders = db.create(Order, pk='id')

# Setup admin routes for each
setup_admin_routes(rt, 'products', products, Product)
setup_admin_routes(rt, 'categories', categories, Category)
setup_admin_routes(rt, 'orders', orders, Order)

# Create admin dashboard
@rt('/admin')
def admin_dashboard(req, sess):
    return Container(
        H1("Admin Dashboard", cls="text-3xl font-bold mb-6"),
        Grid(
            Card(H3("Products"), A("Manage →", href="/admin/products/")),
            Card(H3("Categories"), A("Manage →", href="/admin/categories/")),
            Card(H3("Orders"), A("Manage →", href="/admin/orders/")),
            cols=3
        )
    )
```

## Tests

Let’s test all the admin functionality to ensure it works correctly:

### Test Setup

``` python
# Create test database and models for testing
from tempfile import NamedTemporaryFile
import os

# Create a temporary database for testing
temp_db = NamedTemporaryFile(delete=False, suffix='.db')
test_db_path = temp_db.name
temp_db.close()

# Initialize test database
test_db = Database(test_db_path)

# Define test models
@dataclass
class TestProduct:
    name: str
    price: float
    description: str = ""
    is_active: bool = True
    created_at: datetime = field(default_factory=datetime.utcnow)
    id: Optional[int] = None

@dataclass  
class TestUser:
    username: str
    email: str
    role: str = "user"
    is_active: bool = True
    id: Optional[int] = None

# Create tables
test_products = test_db.create(TestProduct, pk='id')
test_users = test_db.create(TestUser, pk='id')

# Insert test data
test_products.insert(TestProduct(name="Widget", price=19.99, description="A useful widget"))
test_products.insert(TestProduct(name="Gadget", price=29.99, description="An amazing gadget", is_active=False))
test_products.insert(TestProduct(name="Doohickey", price=9.99))

test_users.insert(TestUser(username="alice", email="alice@example.com", role="admin"))
test_users.insert(TestUser(username="bob", email="bob@example.com"))

print(f"Test database created with {len(test_products())} products and {len(test_users())} users")
```

    Test database created with 3 products and 2 users

### Test Form Data Cleaning

``` python
# Test clean_form_data function
test_form_data = {
    'name': 'Test Product',
    'price': '49.99',
    'description': 'A test product',
    'is_active': 'true',
    'created_at': '2024-01-01T10:00'
}

cleaned = clean_form_data(TestProduct, test_form_data)

# Test type conversions
assert cleaned['name'] == 'Test Product'
assert cleaned['price'] == 49.99
assert isinstance(cleaned['price'], float)
assert cleaned['is_active'] == True
assert isinstance(cleaned['is_active'], bool)
assert isinstance(cleaned['created_at'], datetime)

# Test empty values
test_form_data_empty = {
    'name': 'Product',
    'price': '10.0',
    'description': '',  # Empty string should become None or default
    'is_active': ''    # Empty string for bool
}

cleaned_empty = clean_form_data(TestProduct, test_form_data_empty)
assert cleaned_empty['description'] == ""  # Default value
assert 'is_active' not in cleaned_empty or cleaned_empty['is_active'] == True  # Default value

print("✓ Form data cleaning tests passed")
```

    ✓ Form data cleaning tests passed

### Test Field Input Generation

``` python
# Test get_field_input for different field types
from typing import Optional

# Test text input
text_input = get_field_input('name', str, 'Test Name')
assert isinstance(text_input, FT)
assert 'Test Name' in str(text_input)

# Test number input
number_input = get_field_input('price', float, 19.99)
assert isinstance(number_input, FT)
assert '19.99' in str(number_input)
assert 'type="number"' in str(number_input)

# Test boolean checkbox
bool_input = get_field_input('is_active', bool, True)
assert isinstance(bool_input, FT)
assert 'checkbox' in str(bool_input)
assert 'checked' in str(bool_input)

# Test datetime input
dt = datetime(2024, 1, 1, 10, 30)
datetime_input = get_field_input('created_at', datetime, dt)
assert isinstance(datetime_input, FT)
assert 'datetime-local' in str(datetime_input)
assert '2024-01-01T10:30' in str(datetime_input)

# Test textarea for description fields
textarea_input = get_field_input('description', str, 'Long text')
assert isinstance(textarea_input, FT)
assert 'textarea' in str(textarea_input).lower()
assert 'Long text' in str(textarea_input)

# Test Optional types
optional_input = get_field_input('optional_field', Optional[str], 'Value')
assert isinstance(optional_input, FT)

print("✓ Field input generation tests passed")
```

    ✓ Field input generation tests passed

### Test Admin Table Generation

``` python
# Test admin_table function
products = test_products()
table_html = admin_table(products, '/admin/products')

# Convert to string for testing
table_str = str(table_html)

# Check table structure
assert 'table' in table_str.lower()
assert 'thead' in table_str.lower()
assert 'tbody' in table_str.lower()

# Check headers are present (excluding id)
assert 'Name' in table_str
assert 'Price' in table_str
assert 'Description' in table_str
assert 'Is Active' in table_str
assert 'Actions' in table_str

# Check data is present
assert 'Widget' in table_str
assert '19.99' in table_str
assert 'Gadget' in table_str

# Check action buttons
assert '/admin/products/1/edit' in table_str
assert '/admin/products/1/delete' in table_str
assert 'hx-post' in table_str
assert 'hx-confirm' in table_str

# Test empty table
empty_table = admin_table([], '/admin/products')
empty_str = str(empty_table)
assert 'No items found' in empty_str

print("✓ Admin table generation tests passed")
```

    ✓ Admin table generation tests passed

### Test Admin Form Generation

``` python
# Test admin_form for create (no data)
create_form = admin_form(TestProduct, None, '/admin/products/new', 'New Product')
create_str = str(create_form)

# Check form structure
assert 'form' in create_str.lower()
assert 'method="post"' in create_str
assert 'action="/admin/products/new"' in create_str
assert 'New Product' in create_str

# Check fields are present (excluding id)
assert 'name="name"' in create_str
assert 'name="price"' in create_str
assert 'name="description"' in create_str
assert 'name="is_active"' in create_str

# Check buttons
assert 'Save' in create_str
assert 'Cancel' in create_str

# Test admin_form for edit (with data)
product_data = {
    'id': 1,
    'name': 'Test Widget',
    'price': 29.99,
    'description': 'A test widget',
    'is_active': True,
    'created_at': datetime.now()
}
edit_form = admin_form(TestProduct, product_data, '/admin/products/1/edit', 'Edit Product')
edit_str = str(edit_form)

# Check pre-filled values
assert 'Test Widget' in edit_str
assert '29.99' in edit_str
assert 'A test widget' in edit_str
assert 'Edit Product' in edit_str

# Test form with error
error_form = admin_form(TestProduct, None, '/admin/products/new', 'New Product', 
                       error='Name is required')
error_str = str(error_form)
assert 'Name is required' in error_str
assert 'alert' in error_str.lower()

print("✓ Admin form generation tests passed")
```

    ✓ Admin form generation tests passed

### Test Admin List View

``` python
# Test admin_list_view
products = test_products()
list_view = admin_list_view('products', products, page=1, total_pages=1, 
                            search='', base_path='/admin/products')
list_str = str(list_view)

# Check main components
assert 'Products List' in list_str
assert '+ New Products' in list_str
assert '/admin/products/new' in list_str

# Check search form
assert 'search' in list_str.lower()
assert 'placeholder="Search..."' in list_str

# Check table is included
assert 'Widget' in list_str
assert 'Gadget' in list_str

# Test with search
search_view = admin_list_view('products', products, page=1, total_pages=1,
                             search='widget', base_path='/admin/products')
search_str = str(search_view)
assert 'value="widget"' in search_str

# Test with pagination
paginated_view = admin_list_view('products', products, page=2, total_pages=3,
                                search='', base_path='/admin/products')
paginated_str = str(paginated_view)
assert '← Previous' in paginated_str
assert 'Next →' in paginated_str
assert 'page=1' in paginated_str
assert 'page=3' in paginated_str

print("✓ Admin list view tests passed")
```

    ✓ Admin list view tests passed

### Test Search Functionality

``` python
# Test _search_items helper
# Search for "widget" should find the Widget product (case-insensitive)
search_results = _search_items(test_products, TestProduct, 'widget', limit=10, offset=0)
assert len(search_results) >= 1
# Check if Widget is in results (handle both dict and object)
found_widget = False
for p in search_results:
    name = p.name if hasattr(p, 'name') else p.get('name', '')
    if 'widget' in name.lower():
        found_widget = True
        break
assert found_widget, "Should find Widget product"

# Search for "amazing" should find the Gadget (in description)
search_results = _search_items(test_products, TestProduct, 'amazing', limit=10, offset=0)
assert len(search_results) >= 1

# Test pagination in search
search_results = _search_items(test_products, TestProduct, '', limit=2, offset=1)
assert len(search_results) <= 2  # Should get at most 2 items

# Test model with no string fields
@dataclass
class NumericModel:
    count: int
    value: float
    id: Optional[int] = None

numeric_table = test_db.create(NumericModel, pk='id')
numeric_table.insert(NumericModel(count=1, value=1.5))

# Should return results even with no string fields
results = _search_items(numeric_table, NumericModel, 'test', limit=10, offset=0)
assert isinstance(results, list)  # Should not error and return a list

print("✓ Search functionality tests passed")
```

    ✓ Search functionality tests passed

### Test Pagination

``` python
# Test _pagination helper
# Test no pagination needed (1 page)
pagination = _pagination(1, 1, '/admin/products')
assert str(pagination) == '<div></div>'  # Empty div when no pagination needed

# Test basic pagination
pagination = _pagination(2, 5, '/admin/products')
pag_str = str(pagination)
assert '← Previous' in pag_str
assert 'Next →' in pag_str
assert 'page=1' in pag_str
assert 'page=3' in pag_str
assert '<span' in pag_str  # Current page as span

# Test first page
pagination = _pagination(1, 3, '/admin/products')
pag_str = str(pagination)
assert '← Previous' not in pag_str  # No previous on first page
assert 'Next →' in pag_str
assert 'page=2' in pag_str

# Test last page
pagination = _pagination(5, 5, '/admin/products')
pag_str = str(pagination)
assert '← Previous' in pag_str
assert 'Next →' not in pag_str  # No next on last page
assert 'page=4' in pag_str

# Test with search parameter
pagination = _pagination(2, 3, '/admin/products', search='widget')
pag_str = str(pagination)
assert 'search=widget' in pag_str
# Check both parameters are present (order doesn't matter)
assert 'page=1' in pag_str and 'search=widget' in pag_str

print("✓ Pagination tests passed")
```

    ✓ Pagination tests passed

### Test Route Setup (Mock)

``` python
# Test setup_admin_routes with a mock router
class MockRouter:
    """Mock router to test route registration"""
    def __init__(self):
        self.routes = {}
    
    def __call__(self, path):
        def decorator(func):
            # Store both GET and POST handlers
            if path not in self.routes:
                self.routes[path] = {}
            
            # Determine method based on function name
            if 'handler' in func.__name__:
                self.routes[path]['POST'] = func
            else:
                self.routes[path]['GET'] = func
            return func
        return decorator

# Create mock router and setup routes
mock_rt = MockRouter()
setup_admin_routes(mock_rt, 'products', test_products, TestProduct)

# Check all expected routes were created
expected_routes = [
    '/admin/products/',
    '/admin/products/new',
    '/admin/products/{id}/edit',
    '/admin/products/{id}/delete'
]

for route in expected_routes:
    assert route in mock_rt.routes, f"Route {route} not found"

# Check route has both GET and POST where appropriate
assert 'GET' in mock_rt.routes['/admin/products/new']
assert 'POST' in mock_rt.routes['/admin/products/new']
assert 'GET' in mock_rt.routes['/admin/products/{id}/edit']
assert 'POST' in mock_rt.routes['/admin/products/{id}/edit']

# Test custom path prefix
mock_rt2 = MockRouter()
setup_admin_routes(mock_rt2, 'users', test_users, TestUser, path_prefix='/backend')

assert '/backend/users/' in mock_rt2.routes
assert '/admin/users/' not in mock_rt2.routes

print("✓ Route setup tests passed")
```

    ✓ Route setup tests passed

### Test Edge Cases

``` python
# Test edge cases

# 1. Model with all optional fields
@dataclass
class OptionalModel:
    name: Optional[str] = None
    count: Optional[int] = None
    active: Optional[bool] = None
    id: Optional[int] = None

# Should handle optional fields gracefully
form = admin_form(OptionalModel, None, '/test', 'Test')
assert isinstance(form, FT)

# 2. Model with complex types
from typing import List
@dataclass 
class ComplexModel:
    tags: List[str] = field(default_factory=list)
    metadata: Dict[str, Any] = field(default_factory=dict)
    id: Optional[int] = None

# Should handle complex types (defaulting to text inputs)
complex_form = admin_form(ComplexModel, None, '/test', 'Test')
assert isinstance(complex_form, FT)

# 3. Empty form data cleaning
empty_data = {}
cleaned = clean_form_data(TestProduct, empty_data)
# Should handle empty data without errors
assert isinstance(cleaned, dict)

# 4. Special characters in data
special_data = {
    'name': 'Product & <Special>',
    'price': '19.99',
    'description': 'Contains "quotes" and \'apostrophes\''
}
cleaned = clean_form_data(TestProduct, special_data)
assert cleaned['name'] == 'Product & <Special>'
assert cleaned['description'] == 'Contains "quotes" and \'apostrophes\''

# 5. Very long field names
@dataclass
class LongFieldModel:
    this_is_a_very_long_field_name_that_should_still_work: str = ""
    id: Optional[int] = None

input_elem = get_field_input('this_is_a_very_long_field_name_that_should_still_work', str, 'test')
assert isinstance(input_elem, FT)
assert 'This Is A Very Long Field Name That Should Still Work' in str(input_elem)

print("✓ Edge case tests passed")
```

    ✓ Edge case tests passed

### Cleanup

### Integration Test Example

``` python
# Full integration test showing how all components work together
from dataclasses import dataclass
from typing import Optional
from datetime import datetime

# Define a complete model
@dataclass
class Article:
    title: str
    content: str
    author: str
    published: bool = False
    views: int = 0
    published_at: Optional[datetime] = None
    id: Optional[int] = None

# Create test database
integration_db = Database(':memory:')
articles = integration_db.create(Article, pk='id')

# Insert test data
articles.insert(Article(
    title="Getting Started with FastHTML",
    content="FastHTML is a modern web framework...",
    author="John Doe",
    published=True,
    views=150,
    published_at=datetime.now()
))
articles.insert(Article(
    title="Building Admin Panels",
    content="Admin panels are essential for managing content...",
    author="Jane Smith",
    published=False,
    views=0
))

# Test all components work together
# 1. List view
list_html = admin_list_view('articles', articles(), 1, 1, '', '/admin/articles')
assert 'Getting Started with FastHTML' in str(list_html)
assert '150' in str(list_html)  # views

# 2. Create form
create_form_html = admin_form(Article, None, '/admin/articles/new', 'New Article')
assert 'name="title"' in str(create_form_html)
assert 'name="content"' in str(create_form_html)
assert 'name="published"' in str(create_form_html)

# 3. Edit form with data
article = articles[1]
article_dict = vars(article) if hasattr(article, '__dict__') else article
edit_form_html = admin_form(Article, article_dict, f'/admin/articles/1/edit', 'Edit Article')
assert 'Getting Started with FastHTML' in str(edit_form_html)

# 4. Test form data processing
form_data = {
    'title': 'New Article',
    'content': 'Content here',
    'author': 'Test Author',
    'published': 'true',
    'views': '100',
    'published_at': '2024-01-01T10:00'
}
cleaned = clean_form_data(Article, form_data)
assert cleaned['title'] == 'New Article'
assert cleaned['published'] == True
assert cleaned['views'] == 100
assert isinstance(cleaned['published_at'], datetime)

print("✓ Integration test passed - all components work together!")
```

    ✓ Integration test passed - all components work together!

``` python
# Clean up test database
os.unlink(test_db_path)
print("✓ Test database cleaned up")

print("\n🎉 All admin tests passed successfully!")
```

    ✓ Test database cleaned up

    🎉 All admin tests passed successfully!

## Interactive Demo

Let’s create a complete demo app showing all admin features in action:

``` python
# Complete demo app showing all admin features
from fasthtml.common import *
from fasthtml.jupyter import JupyUvi
from ship_kit.auth import *
from ship_kit.permissions import *
from ship_kit.admin import *
from dataclasses import dataclass, field
from datetime import datetime, date
from typing import Optional

# Configure auth beforeware
beforeware = Beforeware(
    user_auth_before,
    skip=['/login', '/', '/public']
)

app, rt = fast_app(before=beforeware)

# Initialize database
demo_db = Database(':memory:')

# Create auth tables directly (since init_auth_tables expects a path, not a Database object)
users_table = demo_db.create(User, pk='id', name='user')
logins_table = demo_db.create(UserLogin, pk='id', name='user_logins')

# Define models for different data types
@dataclass
class Product:
    name: str
    price: float
    category: str
    description: str = ""
    in_stock: bool = True
    created_at: datetime = field(default_factory=datetime.utcnow)
    id: Optional[int] = None

@dataclass
class BlogPost:
    title: str
    content: str
    author: str
    published: bool = False
    publish_date: Optional[date] = None
    views: int = 0
    tags: str = ""  # Comma-separated
    id: Optional[int] = None

@dataclass
class Customer:
    name: str
    email: str
    phone: str = ""
    notes: str = ""
    is_vip: bool = False
    joined: date = field(default_factory=lambda: date.today())
    id: Optional[int] = None

# Create tables
products = demo_db.create(Product, pk='id')
blog_posts = demo_db.create(BlogPost, pk='id')
customers = demo_db.create(Customer, pk='id')

# Insert sample data
# Products
products.insert(Product("Laptop Pro", 1299.99, "Electronics", "High-performance laptop with 16GB RAM"))
products.insert(Product("Wireless Mouse", 29.99, "Accessories", "Ergonomic wireless mouse", True))
products.insert(Product("USB-C Hub", 49.99, "Accessories", "7-in-1 USB-C hub", False))
products.insert(Product("Monitor 4K", 599.99, "Electronics", "27-inch 4K display"))
products.insert(Product("Keyboard Mechanical", 129.99, "Accessories", "RGB mechanical keyboard"))

# Blog posts
blog_posts.insert(BlogPost(
    "Getting Started with FastHTML",
    "FastHTML is a modern Python web framework that makes building web apps simple and fun...",
    "Jane Doe",
    True,
    date(2024, 1, 1),
    1523,
    "tutorial,fasthtml,python"
))
blog_posts.insert(BlogPost(
    "Building Admin Panels the Simple Way",
    "Learn how to create admin panels using simple, composable functions...",
    "John Smith",
    True,
    date(2024, 1, 5),
    892,
    "admin,tutorial,ship-kit"
))
blog_posts.insert(BlogPost(
    "Draft: Advanced Patterns",
    "This post covers advanced patterns in FastHTML...",
    "Jane Doe",
    False,
    None,
    0,
    "advanced,patterns"
))

# Customers
customers.insert(Customer("Alice Johnson", "alice@example.com", "555-0101", "Prefers email contact", True))
customers.insert(Customer("Bob Smith", "bob@example.com", "555-0102"))
customers.insert(Customer("Carol White", "carol@example.com", "", "New customer, follow up next week"))

# Create demo users
create_user(demo_db, "admin@demo.com", "admin", "admin", role="admin")
create_user(demo_db, "user@demo.com", "user", "user", role="user")

# Public home page
@rt('/')
def get():
    return Container(
        Card(
            H1("Admin Panel Demo", cls="text-4xl font-bold mb-4"),
            P("This demo showcases all admin panel features:", cls="text-lg mb-4"),
            Ul(
                Li("✅ CRUD operations for multiple models"),
                Li("✅ Different field types (text, number, boolean, date/time)"),
                Li("✅ Search and pagination"),
                Li("✅ Role-based access control"),
                Li("✅ Responsive MonsterUI components"),
                cls="space-y-2 mb-6"
            ),
            Div(
                H3("Demo Accounts:", cls="text-xl font-semibold mb-2"),
                Ul(
                    Li(Code("admin@demo.com"), " - Password: ", Code("admin"), " (full access)"),
                    Li(Code("user@demo.com"), " - Password: ", Code("user"), " (limited access)"),
                    cls="space-y-1"
                ),
                cls="bg-muted p-4 rounded-lg mb-6"
            ),
            A("Login to Admin Panel", href="/login", cls="btn btn-primary btn-lg")
        )
    )

# Login page
@rt('/login')
def get():
    return Container(
        Card(
            H2("Login to Admin Panel", cls="text-2xl font-bold mb-4"),
            Form(
                LabelInput("Email", name="email", type="email", 
                          value="admin@demo.com", required=True),
                LabelInput("Password", name="password", type="password", 
                          value="admin", required=True),
                Button("Login", type="submit", cls="btn btn-primary w-full mt-4"),
                method="post",
                cls="space-y-4"
            ),
            cls="max-w-md mx-auto"
        )
    )

@rt('/login', methods=['POST'])
async def post(req, sess):
    form_data = await req.form()
    email = form_data.get('email')
    password = form_data.get('password')
    
    user = authenticate_user(demo_db, email, password)
    if user:
        sess['auth'] = create_auth_token(user['id'])
        sess['user'] = user
        return RedirectResponse('/admin', status_code=303)
    
    return Container(
        Alert("Invalid email or password", variant="destructive"),
        A("Try again", href="/login", cls="btn btn-outline mt-4")
    )

# Admin dashboard
@rt('/admin')
@auth_required
def get(req, sess):
    user = get_user_from_session(sess)
    
    return Container(
        H1("Admin Dashboard", cls="text-3xl font-bold mb-6"),
        P(f"Welcome, {user['username']}! (Role: {user['role']})", cls="text-lg mb-6"),
        
        Grid(
            Card(
                H3("Products", cls="text-xl font-semibold mb-2"),
                P(f"{len(products())} products in catalog", cls="text-muted mb-4"),
                A("Manage Products →", href="/admin/products/", cls="btn btn-primary w-full")
            ),
            Card(
                H3("Blog Posts", cls="text-xl font-semibold mb-2"),
                P(f"{len(blog_posts())} posts total", cls="text-muted mb-4"),
                A("Manage Posts →", href="/admin/posts/", cls="btn btn-primary w-full")
            ),
            Card(
                H3("Customers", cls="text-xl font-semibold mb-2"),
                P(f"{len(customers())} registered customers", cls="text-muted mb-4"),
                A("Manage Customers →", href="/admin/customers/", cls="btn btn-primary w-full")
            ),
            cols=3,
            cls="gap-6 mb-6"
        ),
        
        Card(
            H3("Quick Stats", cls="text-xl font-semibold mb-4"),
            Grid(
                Div(
                    P("Published Posts", cls="text-sm text-muted"),
                    P(str(len([p for p in blog_posts() if p.published])), cls="text-2xl font-bold")
                ),
                Div(
                    P("In-Stock Products", cls="text-sm text-muted"),
                    P(str(len([p for p in products() if p.in_stock])), cls="text-2xl font-bold")
                ),
                Div(
                    P("VIP Customers", cls="text-sm text-muted"),
                    P(str(len([c for c in customers() if c.is_vip])), cls="text-2xl font-bold")
                ),
                cols=3,
                cls="gap-6"
            )
        ),
        
        Div(
            A("Logout", href="/logout", cls="btn btn-outline mt-6")
        )
    )

# Setup admin routes for each model
setup_admin_routes(rt, 'products', products, Product)
setup_admin_routes(rt, 'posts', blog_posts, BlogPost, path_prefix='/admin')
setup_admin_routes(rt, 'customers', customers, Customer)

# Logout
@rt('/logout')
def get(sess):
    sess.clear()
    return RedirectResponse('/', status_code=303)

# Run the demo
server = JupyUvi(app)
print("🚀 Admin Panel Demo is running!")
print("   Visit the home page to get started")
```

    <string>:8: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).

<script>
document.body.addEventListener('htmx:configRequest', (event) => {
    if(event.detail.path.includes('://')) return;
    htmx.config.selfRequestsOnly=false;
    event.detail.path = `${location.protocol}//${location.hostname}:8000${event.detail.path}`;
});
</script>

    🚀 Admin Panel Demo is running!
       Visit the home page to get started

### Demo Features

The interactive demo showcases:

1.  **Multiple Model Types**:
    - **Products**: With prices, categories, stock status, and
      timestamps
    - **Blog Posts**: With rich text content, publish dates, view
      counts, and tags
    - **Customers**: With contact info, notes, and VIP status
2.  **Field Type Support**:
    - Text inputs (name, email, title)
    - Number inputs (price, views)
    - Textareas (description, content, notes)
    - Checkboxes (in_stock, published, is_vip)
    - Date pickers (publish_date, joined)
    - DateTime pickers (created_at)
3.  **Admin Features**:
    - List views with sortable columns
    - Create new items with forms
    - Edit existing items
    - Delete with confirmation
    - Search functionality
    - Pagination for large datasets
    - Role-based access control
4.  **User Experience**:
    - Beautiful MonsterUI components
    - Responsive design
    - HTMX for dynamic updates
    - Clear navigation
    - Error handling

``` python
# View the app right here in the notebook by uncommenting the line below
from fasthtml.jupyter import HTMX
# HTMX()
```

``` python
# Stop the server gracefully
# Note: Always run this after testing to clean up otherwise there will be a dangling thread
# https://fastht.ml/docs/tutorials/jupyter_and_fasthtml.html#graceful-shutdowns
print("Stopping server...")
server.stop()
```

    Stopping server...

### Try It Yourself!

To run the demo:

1.  Execute the demo cell above to start the server
2.  Click the home page link to see the landing page
3.  Login with `admin@demo.com` / `admin` for full access
4.  Explore the admin panel features:
    - Browse products, posts, and customers
    - Try searching for items (e.g., “laptop” in products)
    - Create new items using the forms
    - Edit existing items
    - Delete items (with confirmation)
    - Notice how different field types have appropriate inputs
5.  Try logging in as `user@demo.com` / `user` to see role restrictions
6.  Remember to stop the server when done!

## Summary

This improved admin module follows FastHTML and Answer.ai best
practices:

### ✅ What’s Better:

1.  **Uses `rt` Router Pattern** - Routes registered on the FastHTML
    router, not app instance
2.  **Functional Approach** - Simple functions instead of complex
    classes
3.  **Composable** - Each function has a single purpose and can be used
    independently
4.  **Simple Setup** - One line to add admin:
    `setup_admin_routes(rt, 'products', products, Product)`
5.  **Transparent** - No hidden magic, every component is inspectable
6.  **Progressive Enhancement** - Start simple, customize as needed
7.  **Standard Patterns** - Uses FastHTML’s `@rt`, `req`, `sess`, and
    form handling

### 🎯 Key Improvements:

- **Removed Complex Class**: No more `AdminPanel` class with dozens of
  methods
- **Follows `rt` Pattern**: Routes use `@rt()` decorator like all
  FastHTML apps
- **Single Purpose Functions**: Each function does one thing well
- **Easy to Understand**: Linear flow from simple to complex use cases
- **Customizable Components**: Use
  [`admin_table()`](https://LotsOfOrg.github.io/ship-kit/admin.html#admin_table),
  [`admin_form()`](https://LotsOfOrg.github.io/ship-kit/admin.html#admin_form)
  in your own routes
- **FastHTML Native**: Uses standard req/sess/form patterns throughout

This approach embodies Jeremy Howard’s philosophy: “Simple things should
be simple, complex things should be possible.” You can set up admin in
one line, but every component is accessible for customization.

### Integration with Other Modules

The admin module seamlessly integrates with other Ship Kit modules: -
**Authentication**: Uses
[`require_role`](https://LotsOfOrg.github.io/ship-kit/permissions.html#require_role)
from permissions module for auth checks - **Permissions**: Default auth
check requires ‘admin’ role - **Session Schema**: Follows consistent
session patterns from auth module
