# FastHTML SaaS Toolkit Vision

## Package Name: `launch-kit`

A comprehensive toolkit for building production-ready SaaS applications with FastHTML, developed using nbdev for literate programming, integrated testing, and excellent documentation. This approach aligns with FastHTML's own development methodology, ensuring consistency and quality.

## Core Architecture

### 1. nbdev-Based Package Structure

```
launch-kit/
├── settings.ini              # nbdev configuration
├── setup.py                  # Generated by nbdev
├── README.md                 # Generated from index.ipynb
├── LICENSE
├── MANIFEST.in
├── nbs/                      # All development in notebooks
│   ├── index.ipynb          # Package overview & docs
│   ├── 00_core.ipynb        # Core utilities and base classes
│   ├── 01_config.ipynb      # Configuration management
│   ├── 02_database.ipynb    # Database helpers & models
│   ├── 03_auth.ipynb        # Authentication system
│   ├── 04_auth_providers.ipynb  # OAuth & magic links
│   ├── 05_permissions.ipynb # RBAC & authorization
│   ├── 06_admin.ipynb       # Admin dashboard
│   ├── 07_admin_components.ipynb # Admin UI components
│   ├── 08_teams.ipynb       # Team management
│   ├── 09_billing.ipynb     # Subscription management
│   ├── 10_billing_providers.ipynb # Stripe, Paddle, etc.
│   ├── 11_api.ipynb         # API key management
│   ├── 12_notifications.ipynb # Email & in-app notifications
│   ├── 13_ui_components.ipynb # Reusable UI components
│   ├── 14_ui_forms.ipynb    # Form helpers & validation
│   ├── 15_middleware.ipynb  # CSRF, rate limiting, etc.
│   ├── 16_cli.ipynb         # CLI tools
│   ├── 17_testing.ipynb     # Testing utilities
│   │
│   ├── examples/            # Example notebooks
│   │   ├── 01_quickstart.ipynb
│   │   ├── 02_custom_auth.ipynb
│   │   ├── 03_admin_customization.ipynb
│   │   ├── 04_billing_integration.ipynb
│   │   └── 05_full_saas_app.ipynb
│   │
│   └── tutorials/           # Step-by-step tutorials
│       ├── 01_getting_started.ipynb
│       ├── 02_authentication.ipynb
│       ├── 03_building_admin.ipynb
│       └── 04_deployment.ipynb
│
├── launch_kit/              # Generated Python package
│   ├── __init__.py         # Auto-generated exports
│   ├── core.py            # From 00_core.ipynb
│   ├── config.py          # From 01_config.ipynb
│   ├── database.py        # From 02_database.ipynb
│   ├── auth.py            # From 03_auth.ipynb
│   └── ...                # All other modules
│
├── docs/                    # Generated documentation
│   ├── index.html          # From notebooks
│   ├── core.html
│   ├── auth.html
│   └── ...
│
├── tests/                   # Tests extracted from notebooks
│   └── test_*.py           # Auto-generated from notebook cells
│
└── templates/              # Project templates
    ├── basic/
    ├── advanced/
    └── enterprise/
```

### 2. nbdev Development Approach

#### Notebook Organization
Each notebook follows nbdev conventions with clear exports, tests, and documentation:

```python
# In 03_auth.ipynb
#| default_exp auth
#| export
from fasthtml.common import *
from dataclasses import dataclass
import bcrypt

#| export
@dataclass
class AuthConfig:
    """Configuration for authentication system
    
    All settings are documented with examples in the notebook cells.
    Tests demonstrate various configuration scenarios.
    """
    session_key: str = "auth"
    session_lifetime: int = 86400
    require_email_verification: bool = True
    enable_2fa: bool = False
    max_login_attempts: int = 5
    lockout_duration: int = 300

#| export
class Auth:
    """Main authentication class with comprehensive examples"""
    def __init__(self, app, config: AuthConfig = None):
        self.config = config or AuthConfig()
        self._setup_routes()

# Test cells demonstrate usage
#| test
config = AuthConfig(require_email_verification=False)
assert config.session_key == "auth"
assert not config.require_email_verification

# Test password hashing
auth = Auth(None, config)
hashed = auth.hash_password("secure_password123")
assert auth.verify_password("secure_password123", hashed)
assert not auth.verify_password("wrong_password", hashed)

# Test session creation
session_token = auth.create_session(user_id=1)
assert len(session_token) == 64  # 32 bytes hex encoded

# Visual test - render login form
login_form = auth.render_login_form()
display(login_form)  # Shows form in notebook
```

#### Documentation Through Examples
Each notebook includes rich examples that become documentation:

```python
# In examples/01_quickstart.ipynb
#| doc
"""
# FastHTML SaaS Quickstart

This notebook demonstrates setting up a basic SaaS application
with authentication and admin panel in under 50 lines of code.
"""

from launch_kit import create_saas_app, SaaSConfig

# Create configuration
config = SaaSConfig(
    app_name="My SaaS",
    features=["auth", "admin"],
    database_url="sqlite:///myapp.db"
)

# Create application
app = create_saas_app(config)

# Add custom route
@app.get("/")
def home(req):
    return f"Welcome {req.user.username}!"

# Run the app
if __name__ == "__main__":
    app.run()
```

### 3. Key Abstractions

#### Unified Configuration (from 01_config.ipynb)
```python
#| export
import os
from dataclasses import dataclass, field
from typing import Dict, List, Optional, Any
from datetime import timedelta
from pathlib import Path

@dataclass
class SaaSConfig:
    """Central configuration for all SaaS features
    
    Examples in notebook show different configuration scenarios:
    - Basic auth-only setup
    - Full-featured enterprise configuration
    - Custom provider configurations
    """
    # Core settings
    app_name: str
    secret_key: str = field(default_factory=lambda: os.urandom(32).hex())
    database_url: str = "sqlite:///data/app.db"
    base_url: str = "http://localhost:5000"  # For email links, webhooks
    
    # Paths
    static_path: Path = Path("static")
    template_path: Path = Path("templates")
    upload_path: Path = Path("uploads")
    
    # Feature flags with granular control
    features: Dict[str, bool] = field(default_factory=lambda: {
        "auth": True,
        "auth.registration": True,
        "auth.email_verification": True,
        "auth.password_reset": True,
        "auth.2fa": False,
        "teams": False,
        "teams.invitations": False,
        "billing": False,
        "billing.trials": False,
        "api": False,
        "api.rate_limiting": False,
        "admin": True,
        "admin.impersonation": False,
    })
    
    # Provider configuration
    auth_providers: List[str] = field(default_factory=lambda: ["password"])
    oauth_providers: Dict[str, Dict[str, str]] = field(default_factory=dict)
    billing_provider: Optional[str] = None
    billing_config: Dict[str, Any] = field(default_factory=dict)
    email_provider: str = "console"  # console, smtp, resend, postmark
    email_config: Dict[str, Any] = field(default_factory=dict)
    
    # Security settings
    session_lifetime: timedelta = timedelta(days=30)
    require_email_verification: bool = True
    enforce_2fa: bool = False
    password_min_length: int = 8
    password_require_special: bool = True
    max_login_attempts: int = 5
    lockout_duration: timedelta = timedelta(minutes=15)
    
    # Performance settings
    cache_enabled: bool = True
    cache_backend: str = "memory"  # memory, redis, memcached
    db_pool_size: int = 5
    db_max_overflow: int = 10
    
    def __post_init__(self):
        """Validate configuration after initialization"""
        # Create directories if they don't exist
        for path in [self.static_path, self.template_path, self.upload_path]:
            path.mkdir(parents=True, exist_ok=True)
        
        # Validate feature dependencies
        if self.features.get("teams") and not self.features.get("auth"):
            raise ValueError("Teams feature requires auth to be enabled")
        
        if self.features.get("billing") and not self.features.get("auth"):
            raise ValueError("Billing feature requires auth to be enabled")

# Test different configurations
#| test
basic_config = SaaSConfig(app_name="Test App")
assert basic_config.features["auth"] == True
assert basic_config.features["teams"] == False

enterprise_config = SaaSConfig(
    app_name="Enterprise App",
    features={"auth": True, "teams": True, "billing": True, "api": True, "admin": True},
    auth_providers=["password", "google", "saml"],
    billing_provider="stripe",
    enforce_2fa=True
)
assert enterprise_config.enforce_2fa == True
```

#### Base Application Factory (from 00_core.ipynb)
```python
#| export
import logging
import os
from typing import Dict, List, Optional, Any
from fasthtml.common import *
from .middleware import setup_middleware
from .database import setup_database
from .cache import setup_cache

def create_saas_app(config: SaaSConfig = None) -> FastHTML:
    """Create a FastHTML app with SaaS features enabled
    
    The notebook includes detailed examples of:
    - Basic setup with just auth
    - Adding team management
    - Integrating billing
    - Full enterprise setup
    """
    # Use default config if none provided
    if config is None:
        config = SaaSConfig(app_name="SaaS App")
    
    # Create FastHTML app with configuration
    app = FastHTML(
        hdrs=(
            Meta(name="viewport", content="width=device-width, initial-scale=1"),
            Link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"),
            Script(src="https://unpkg.com/htmx.org@1.9.10"),
            Script(src="https://unpkg.com/hyperscript.org@0.9.12"),
        ),
        ws_hdr=True,  # Enable WebSocket support
        secret_key=config.secret_key,
    )
    
    # Store config on app for access in routes
    app.config = config
    
    # Set up logging
    logging.basicConfig(
        level=logging.INFO,
        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
    logger = logging.getLogger(config.app_name)
    app.logger = logger
    
    # Core setup (always needed)
    setup_database(app, config)
    setup_middleware(app, config)
    
    if config.cache_enabled:
        setup_cache(app, config)
    
    # Register enabled features
    if config.features.get("auth"):
        from .auth import setup_auth
        setup_auth(app, config)
        logger.info("Authentication system enabled")
    
    if config.features.get("admin"):
        from .admin import setup_admin
        setup_admin(app, config)
        logger.info("Admin dashboard enabled")
    
    if config.features.get("teams"):
        from .teams import setup_teams
        setup_teams(app, config)
        logger.info("Team management enabled")
    
    if config.features.get("billing"):
        from .billing import setup_billing
        setup_billing(app, config)
        logger.info("Billing system enabled")
    
    if config.features.get("api"):
        from .api import setup_api
        setup_api(app, config)
        logger.info("API management enabled")
    
    # Add default routes
    @app.get("/")
    def index(req):
        """Landing page - shows different content based on auth status"""
        if hasattr(req, 'user') and req.user:
            return RedirectResponse("/dashboard")
        return Div(
            H1(config.app_name, cls="text-4xl font-bold text-center mt-8"),
            Div(
                A("Login", href="/auth/login", cls="btn btn-primary"),
                A("Sign Up", href="/auth/register", cls="btn btn-secondary ml-4"),
                cls="flex justify-center mt-8"
            )
        )
    
    @app.get("/health")
    def health_check():
        """Health check endpoint for monitoring"""
        return {"status": "healthy", "app": config.app_name}
    
    return app

# Demonstrate with tests
#| test
test_config = SaaSConfig(app_name="Test", features={"auth": True})
test_app = create_saas_app(test_config)
assert test_app is not None
```

### 4. Feature Modules (Developed in Notebooks)

Each feature module is developed in its own notebook with inline tests and examples:

#### Authentication Module (03_auth.ipynb, 04_auth_providers.ipynb)
```python
#| doc
"""
# Authentication System

This notebook implements a complete authentication system for FastHTML apps.
Each section includes examples and tests demonstrating the functionality.
"""

#| export
import bcrypt
import secrets
import os
from datetime import datetime, timedelta
from typing import Optional, Dict, Any
from dataclasses import dataclass
from fasthtml.common import *

@dataclass
class User:
    """User model with authentication fields"""
    id: int
    email: str
    username: str
    password_hash: str
    email_verified: bool = False
    is_admin: bool = False
    is_active: bool = True
    created_at: datetime = field(default_factory=datetime.utcnow)
    last_login: Optional[datetime] = None
    failed_login_attempts: int = 0
    locked_until: Optional[datetime] = None
    two_factor_secret: Optional[str] = None

#| export
class AuthenticationSystem:
    """
    Features implemented in this notebook:
    - Session-based auth with secure cookies
    - Password authentication with bcrypt
    - Email verification flow
    - Password reset functionality
    - Rate limiting and account lockout
    - Two-factor authentication
    
    See cells below for implementation details and examples.
    """
    
    def __init__(self, app, config):
        self.app = app
        self.config = config
        self.setup_routes()
    
    def hash_password(self, password: str) -> str:
        """Hash password using bcrypt with cost factor 12"""
        return bcrypt.hashpw(password.encode('utf-8'), bcrypt.gensalt(12)).decode('utf-8')
    
    def verify_password(self, password: str, hashed: str) -> bool:
        """Verify password against hash (timing-safe)"""
        return bcrypt.checkpw(password.encode('utf-8'), hashed.encode('utf-8'))
    
    def create_session(self, user_id: int) -> str:
        """Create secure session token"""
        token = secrets.token_urlsafe(32)
        # Store in database with expiry
        expires_at = datetime.utcnow() + self.config.session_lifetime
        # Save to sessions table...
        return token
    
    def setup_routes(self):
        """Set up authentication routes"""
        
        @self.app.get("/auth/login")
        def login_page(req):
            return Div(
                H2("Login", cls="text-2xl font-bold mb-4"),
                Form(
                    Input(type="email", name="email", placeholder="Email", required=True),
                    Input(type="password", name="password", placeholder="Password", required=True),
                    Div(
                        Input(type="checkbox", name="remember_me", id="remember"),
                        Label("Remember me", fr="remember"),
                        cls="flex items-center mb-4"
                    ),
                    Button("Login", type="submit", cls="btn btn-primary w-full"),
                    method="post",
                    action="/auth/login",
                    hx_post="/auth/login",
                    hx_target="#content"
                ),
                P(
                    "Don't have an account? ",
                    A("Sign up", href="/auth/register", cls="text-blue-500"),
                    cls="mt-4 text-center"
                )
            )
        
        @self.app.post("/auth/login")
        async def login(req):
            form = await req.form()
            email = form.get("email")
            password = form.get("password")
            remember = form.get("remember_me") == "on"
            
            # Find user and verify password
            user = self.get_user_by_email(email)
            if not user or not self.verify_password(password, user.password_hash):
                return Div(
                    P("Invalid email or password", cls="text-red-500"),
                    hx_swap_oob="true"
                )
            
            # Check if account is locked
            if user.locked_until and user.locked_until > datetime.utcnow():
                return Div(
                    P(f"Account locked. Try again in {(user.locked_until - datetime.utcnow()).seconds // 60} minutes",
                      cls="text-red-500"),
                    hx_swap_oob="true"
                )
            
            # Create session
            session_token = self.create_session(user.id)
            
            # Set cookie with appropriate lifetime
            lifetime = self.config.session_lifetime if remember else timedelta(hours=24)
            req.set_cookie(
                "session",
                session_token,
                max_age=int(lifetime.total_seconds()),
                httponly=True,
                secure=True,
                samesite="lax"
            )
            
            # Update last login
            user.last_login = datetime.utcnow()
            user.failed_login_attempts = 0
            # Save user...
            
            return RedirectResponse("/dashboard", status_code=303)
```

#### Admin Module (06_admin.ipynb, 07_admin_components.ipynb)
```python
#| doc
"""
# Admin Dashboard

This notebook creates a flexible admin dashboard system.
Examples show how to customize for different use cases.
"""

#| export
import os
import json
from typing import List, Dict, Any, Optional
from datetime import datetime, timedelta
from fasthtml.common import *

class AdminDashboard:
    """
    Provides:
    - Auto-generated CRUD interfaces
    - User management with search/filter
    - System metrics and monitoring
    - Audit logging with search
    - Customizable UI components
    
    Tests demonstrate various customization scenarios.
    """
    
    def __init__(self, app, config):
        self.app = app
        self.config = config
        self.setup_routes()
    
    def setup_routes(self):
        """Configure admin routes with authentication"""
        
        @self.app.get("/admin")
        @admin_required  # Decorator checks is_admin=True
        def admin_dashboard(req):
            stats = self.get_dashboard_stats()
            return AdminLayout(
                H1("Admin Dashboard", cls="text-3xl font-bold mb-6"),
                
                # Stats cards
                Div(
                    StatCard("Total Users", stats['total_users'], icon="users"),
                    StatCard("Active Today", stats['active_today'], icon="activity"),
                    StatCard("New This Week", stats['new_this_week'], icon="user-plus"),
                    StatCard("Revenue MTD", f"${stats['revenue_mtd']:,.2f}", icon="dollar"),
                    cls="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8"
                ),
                
                # Charts
                Div(
                    Card(
                        H3("User Growth", cls="text-xl font-semibold mb-4"),
                        Div(id="user-growth-chart", cls="h-64"),
                        hx_get="/admin/charts/user-growth",
                        hx_trigger="load"
                    ),
                    Card(
                        H3("Recent Activity", cls="text-xl font-semibold mb-4"),
                        ActivityFeed(self.get_recent_activity()),
                    ),
                    cls="grid grid-cols-1 lg:grid-cols-2 gap-6"
                )
            )
        
        @self.app.get("/admin/users")
        @admin_required
        def user_management(req):
            # Get query parameters
            search = req.query_params.get('search', '')
            status = req.query_params.get('status', 'all')
            page = int(req.query_params.get('page', 1))
            
            users, total = self.get_users(search=search, status=status, page=page)
            
            return AdminLayout(
                H1("User Management", cls="text-3xl font-bold mb-6"),
                
                # Search and filters
                Form(
                    Div(
                        Input(
                            type="search",
                            name="search",
                            placeholder="Search users...",
                            value=search,
                            cls="w-full md:w-64"
                        ),
                        Select(
                            Option("All Users", value="all", selected=status=="all"),
                            Option("Active", value="active", selected=status=="active"),
                            Option("Inactive", value="inactive", selected=status=="inactive"),
                            Option("Admins", value="admin", selected=status=="admin"),
                            name="status",
                            cls="ml-4"
                        ),
                        Button("Search", type="submit", cls="btn btn-primary ml-4"),
                        cls="flex items-center mb-6"
                    ),
                    method="get",
                    hx_get="/admin/users",
                    hx_target="#user-table",
                    hx_push_url="true"
                ),
                
                # User table
                Div(
                    Table(
                        Thead(
                            Tr(
                                Th("Username"),
                                Th("Email"),
                                Th("Status"),
                                Th("Created"),
                                Th("Last Login"),
                                Th("Actions")
                            )
                        ),
                        Tbody(
                            *[self.render_user_row(user) for user in users]
                        ),
                        cls="w-full"
                    ),
                    id="user-table"
                ),
                
                # Pagination
                self.render_pagination(page, total, per_page=20)
            )
    
    def render_user_row(self, user):
        """Render a single user row with actions"""
        return Tr(
            Td(user.username),
            Td(user.email),
            Td(
                Span(
                    "Active" if user.is_active else "Inactive",
                    cls=f"px-2 py-1 rounded text-sm {'bg-green-100 text-green-800' if user.is_active else 'bg-gray-100 text-gray-800'}"
                )
            ),
            Td(user.created_at.strftime("%Y-%m-%d")),
            Td(user.last_login.strftime("%Y-%m-%d %H:%M") if user.last_login else "Never"),
            Td(
                Button(
                    "Edit",
                    hx_get=f"/admin/users/{user.id}/edit",
                    hx_target="#modal",
                    cls="btn btn-sm btn-secondary mr-2"
                ),
                Button(
                    "Disable" if user.is_active else "Enable",
                    hx_post=f"/admin/users/{user.id}/toggle",
                    hx_swap="outerHTML",
                    cls="btn btn-sm btn-warning"
                )
            )
        )

# Test rendering components
#| test
# Create sample data
sample_users = [
    User(id=1, username="john_doe", email="john@example.com", 
         password_hash="...", is_active=True, created_at=datetime(2024, 1, 1)),
    User(id=2, username="jane_smith", email="jane@example.com",
         password_hash="...", is_active=False, created_at=datetime(2024, 1, 2))
]

# Test admin dashboard initialization
admin = AdminDashboard(None, SaaSConfig(app_name="Test"))

# Test user row rendering
row = admin.render_user_row(sample_users[0])
assert "john_doe" in str(row)
assert "Active" in str(row)

# Visual test - render user table
table = Table(
    Tbody(*[admin.render_user_row(user) for user in sample_users])
)
display(table)
```

#### Interactive Development Benefits
The nbdev approach provides several advantages:

1. **Live Documentation**: Each notebook cell can be executed to see results
2. **Integrated Testing**: Tests live alongside the code they test
3. **Visual Development**: UI components can be rendered in notebooks
4. **Exploratory Coding**: Try ideas interactively before committing

Example from a UI components notebook:
```python
# In 13_ui_components.ipynb
#| doc
"""Let's create a reusable data table component"""

#| export
import os
from typing import List, Dict, Any, Optional, Callable
from fasthtml.common import *

def DataTable(
    columns: List[str], 
    data: List[Dict[str, Any]], 
    actions: Optional[List[Callable]] = None,
    sortable: bool = True,
    filterable: bool = True,
    selectable: bool = False
):
    """Create a sortable, filterable data table with HTMX integration"""
    
    table_id = f"table-{id(data)}"  # Unique ID for HTMX targeting
    
    return Div(
        # Filter input
        Input(
            type="search",
            placeholder="Filter...",
            hx_post=f"/tables/{table_id}/filter",
            hx_trigger="keyup changed delay:500ms",
            hx_target=f"#{table_id}",
            cls="mb-4 w-full md:w-64"
        ) if filterable else None,
        
        # Table
        Table(
            Thead(
                Tr(
                    *[
                        Th(
                            Div(
                                col,
                                I(cls="fas fa-sort ml-2") if sortable else None,
                                cls="flex items-center cursor-pointer" if sortable else "",
                                hx_get=f"/tables/{table_id}/sort?col={i}" if sortable else None,
                                hx_target=f"#{table_id}" if sortable else None
                            )
                        ) for i, col in enumerate(columns)
                    ],
                    Th("Actions") if actions else None
                )
            ),
            Tbody(
                *[
                    Tr(
                        *[
                            Td(
                                Checkbox(
                                    name="selected",
                                    value=row.get('id', i),
                                    cls="row-select"
                                ) if selectable and j == 0 else row.get(col.lower(), '')
                            ) for j, col in enumerate(columns)
                        ],
                        Td(
                            *[
                                Button(
                                    action.__name__.replace('_', ' ').title(),
                                    hx_post=f"/tables/{table_id}/action/{action.__name__}/{row.get('id', i)}",
                                    hx_swap="outerHTML",
                                    cls="btn btn-sm mr-1"
                                ) for action in (actions or [])
                            ]
                        ) if actions else None,
                        id=f"row-{row.get('id', i)}"
                    ) for i, row in enumerate(data)
                ]
            ),
            id=table_id,
            cls="w-full"
        ),
        
        # Bulk actions for selectable tables
        Div(
            Select(
                Option("Bulk Actions", value="", disabled=True, selected=True),
                Option("Delete Selected", value="delete"),
                Option("Export Selected", value="export"),
                name="bulk_action",
                cls="mr-2"
            ),
            Button(
                "Apply",
                hx_post=f"/tables/{table_id}/bulk",
                hx_include=".row-select:checked",
                cls="btn btn-primary"
            ),
            cls="mt-4 flex items-center"
        ) if selectable else None
    )

# Visual test - this renders in the notebook!
#| test
sample_data = [
    {"id": 1, "name": "John Doe", "email": "john@example.com", "role": "Admin", "status": "Active"},
    {"id": 2, "name": "Jane Smith", "email": "jane@example.com", "role": "User", "status": "Active"},
    {"id": 3, "name": "Bob Johnson", "email": "bob@example.com", "role": "User", "status": "Inactive"}
]

# Define actions
def edit_user(user_id): pass
def toggle_status(user_id): pass

table = DataTable(
    columns=["Name", "Email", "Role", "Status"],
    data=sample_data,
    actions=[edit_user, toggle_status],
    sortable=True,
    filterable=True,
    selectable=True
)
display(table)  # Shows rendered table in notebook

# Test that all features are present
table_html = str(table)
assert "Filter..." in table_html  # Filter input present
assert "fa-sort" in table_html  # Sort icons present
assert "checkbox" in table_html  # Selection checkboxes present
assert "Edit User" in table_html  # Action buttons present
assert "Bulk Actions" in table_html  # Bulk actions present
```

### 5. Developer Experience

#### nbdev Workflow Integration
The package leverages nbdev's features for an enhanced developer experience:

```bash
# Development workflow
nbdev_preview  # Live preview of docs while developing
nbdev_test     # Run all tests from notebooks
nbdev_export   # Export notebooks to Python modules
nbdev_clean    # Clean notebooks for git commits
nbdev_install_hooks  # Install git hooks for clean commits
```

#### CLI Tool (Developed in 16_cli.ipynb)
```bash
# Create new project
launch-kit new myapp --template=advanced

# Add features to existing project
launch-kit add billing --provider=stripe
launch-kit add auth --providers=google,github

# Database management
launch-kit db init
launch-kit db migrate
launch-kit db seed

# Development tools
launch-kit dev     # Run with hot reload
launch-kit test    # Run test suite
launch-kit deploy  # Deploy wizard
```

#### Project Templates

**Basic Template**
- Authentication (password only)
- User dashboard
- Settings page
- SQLite database

**Advanced Template**
- Multi-provider auth
- Team management
- Billing integration
- Admin dashboard
- PostgreSQL ready

**Enterprise Template**
- Everything in Advanced
- API management
- Advanced audit logging
- Multi-tenancy support
- Redis caching
- Background jobs

### 6. Integration with FastHTML

#### nbdev + FastHTML Synergy
The combination of nbdev and FastHTML creates powerful development patterns:
```python
#| export
import os
from typing import Dict, List, Optional, Any
from fasthtml.common import *
from functools import wraps
from launch_kit import get_current_user, get_team_member

def authenticated(f):
    """Decorator to require authentication"""
    @wraps(f)
    async def wrapper(req, *args, **kwargs):
        # Check session cookie
        session_token = req.cookies.get('session')
        if not session_token:
            return RedirectResponse('/auth/login?next=' + req.url.path)
        
        # Validate session and get user
        user = await get_current_user(session_token)
        if not user:
            return RedirectResponse('/auth/login?next=' + req.url.path)
        
        # Add user to request scope
        req.scope['user'] = user
        return await f(req, *args, **kwargs)
    return wrapper

def team_required(role: str = 'member'):
    """Decorator to require team membership with specific role"""
    def decorator(f):
        @wraps(f)
        @authenticated  # Also requires authentication
        async def wrapper(req, *args, **kwargs):
            team_id = kwargs.get('team_id')
            if not team_id:
                return HTMLResponse("Team ID required", status_code=400)
            
            # Check team membership
            member = await get_team_member(req.scope['user'].id, team_id)
            if not member:
                return HTMLResponse("Not a team member", status_code=403)
            
            # Check role hierarchy
            role_hierarchy = ['member', 'admin', 'owner']
            if role_hierarchy.index(member.role) < role_hierarchy.index(role):
                return HTMLResponse(f"{role} role required", status_code=403)
            
            # Add team to request scope
            req.scope['team'] = member.team
            req.scope['team_member'] = member
            return await f(req, *args, **kwargs)
        return wrapper
    return decorator

def subscription_required(tier: str = 'free', feature: str = None):
    """Decorator to require specific subscription tier or feature"""
    def decorator(f):
        @wraps(f)
        async def wrapper(req, *args, **kwargs):
            # Get team from scope (requires team_required decorator)
            team = req.scope.get('team')
            if not team:
                return HTMLResponse("Team context required", status_code=400)
            
            # Check subscription
            tier_hierarchy = ['free', 'starter', 'pro', 'enterprise']
            team_tier_index = tier_hierarchy.index(team.subscription_tier)
            required_tier_index = tier_hierarchy.index(tier)
            
            if team_tier_index < required_tier_index:
                return Div(
                    H2("Upgrade Required", cls="text-2xl font-bold mb-4"),
                    P(f"This feature requires the {tier.title()} plan or higher."),
                    A("Upgrade Now", href="/billing/upgrade", cls="btn btn-primary mt-4")
                )
            
            # Check specific feature if provided
            if feature and not team.has_feature(feature):
                return HTMLResponse(f"Feature '{feature}' not available", status_code=403)
            
            return await f(req, *args, **kwargs)
        return wrapper
    return decorator

# Example usage
@app.get("/dashboard")
@authenticated
async def dashboard(req):
    user = req.scope["user"]
    return PageLayout(
        H1(f"Welcome back, {user.username}!", cls="text-3xl font-bold mb-6"),
        DashboardStats(user),
        RecentActivity(user),
        QuickActions(user),
        title="Dashboard",
        user=user
    )

@app.get("/team/{team_id}/settings")
@team_required(role="admin")
@subscription_required(tier="pro")
async def team_settings(req, team_id: str):
    team = req.scope["team"]
    member = req.scope["team_member"]
    
    return PageLayout(
        H1(f"{team.name} Settings", cls="text-3xl font-bold mb-6"),
        Tabs(
            Tab("General", TeamGeneralSettings(team)),
            Tab("Members", TeamMemberManagement(team, member)),
            Tab("Billing", TeamBillingSettings(team)),
            Tab("Security", TeamSecuritySettings(team)),
            Tab("Integrations", TeamIntegrations(team))
        ),
        title=f"{team.name} Settings",
        user=req.scope["user"]
    )

# Test decorators
#| test
# Mock request object
class MockRequest:
    def __init__(self, cookies=None, path="/"):
        self.cookies = cookies or {}
        self.scope = {}
        self.url = type('obj', (object,), {'path': path})

# Test authenticated decorator
@authenticated
async def protected_route(req):
    return f"Hello {req.scope['user'].username}"

# Test without session
req = MockRequest()
response = await protected_route(req)
assert isinstance(response, RedirectResponse)
assert response.headers['location'] == '/auth/login?next=/'

# Test with valid session
req = MockRequest(cookies={'session': 'valid_token'})
# Would need to mock get_current_user for full test

print("✓ Decorator tests passed")
```

#### Component Library
```python
from launch_kit.ui import (
    SaaSLayout,      # Full app layout with nav
    AuthForm,        # Login/signup forms
    PricingTable,    # Billing tier display
    UserTable,       # Admin user management
    TeamSelector,    # Team switcher component
    ApiKeyManager,   # API key CRUD UI
)

# Pre-styled, accessible components
form = AuthForm(
    mode="login",
    providers=["google", "github"],
    on_success="/dashboard"
)
```

### 7. Database Approach (02_database.ipynb)

#### Literate Database Development
Database schema and migrations are developed in notebooks with visual feedback:
```python
#| export
import os
import sqlite3
from typing import Dict, List, Optional, Any
from datetime import datetime
from launch_kit.db import Migration, Schema

class AddTeamsTable(Migration):
    """Add teams table for multi-tenant support"""
    
    version = "001"  # Migration version for ordering
    
    def up(self, db):
        """Apply migration"""
        db.execute("""
            CREATE TABLE teams (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                name TEXT NOT NULL,
                slug TEXT UNIQUE NOT NULL,
                owner_id INTEGER NOT NULL,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                settings JSON DEFAULT '{}',
                subscription_tier TEXT DEFAULT 'free',
                subscription_status TEXT DEFAULT 'active',
                FOREIGN KEY (owner_id) REFERENCES users(id)
            )
        """)
        
        # Create indexes
        db.execute("CREATE INDEX idx_teams_slug ON teams(slug)")
        db.execute("CREATE INDEX idx_teams_owner ON teams(owner_id)")
        
        # Create team_members junction table
        db.execute("""
            CREATE TABLE team_members (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                team_id INTEGER NOT NULL,
                user_id INTEGER NOT NULL,
                role TEXT NOT NULL DEFAULT 'member',
                joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (team_id) REFERENCES teams(id) ON DELETE CASCADE,
                FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
                UNIQUE(team_id, user_id)
            )
        """)
        
        db.execute("CREATE INDEX idx_team_members_team ON team_members(team_id)")
        db.execute("CREATE INDEX idx_team_members_user ON team_members(user_id)")
    
    def down(self, db):
        """Rollback migration"""
        db.execute("DROP TABLE IF EXISTS team_members")
        db.execute("DROP TABLE IF EXISTS teams")

# Test migration in notebook
#| test
# Create in-memory database for testing
test_db = sqlite3.connect(":memory:")

# First create users table (dependency)
test_db.execute("""
    CREATE TABLE users (
        id INTEGER PRIMARY KEY,
        email TEXT UNIQUE NOT NULL
    )
""")

# Apply migration
migration = AddTeamsTable()
migration.up(test_db)

# Verify tables were created
cursor = test_db.execute("SELECT name FROM sqlite_master WHERE type='table'")
tables = [row[0] for row in cursor]
assert 'teams' in tables
assert 'team_members' in tables

# Test inserting data
test_db.execute("INSERT INTO users (id, email) VALUES (1, 'test@example.com')")
test_db.execute("INSERT INTO teams (name, slug, owner_id) VALUES ('Test Team', 'test-team', 1)")
test_db.execute("INSERT INTO team_members (team_id, user_id, role) VALUES (1, 1, 'owner')")

# Verify data
team = test_db.execute("SELECT * FROM teams WHERE slug = 'test-team'").fetchone()
assert team is not None
assert team[1] == 'Test Team'  # name

# Test rollback
migration.down(test_db)
cursor = test_db.execute("SELECT name FROM sqlite_master WHERE type='table'")
tables = [row[0] for row in cursor]
assert 'teams' not in tables
assert 'team_members' not in tables

print("✓ Migration test passed")
```

#### Active Record Pattern
```python
from launch_kit.db import Model

class Project(Model):
    table_name = "projects"
    
    # Relationships
    team = belongs_to(Team)
    members = has_many(User, through="project_members")
    
    # Scopes
    @classmethod
    def active(cls):
        return cls.where(status="active")
    
    # Validations
    def validate(self):
        if not self.name:
            raise ValueError("Project name is required")
```

### 8. Testing Support (17_testing.ipynb)

#### nbdev Testing Philosophy
Tests are written inline with the code in notebooks, making them part of the documentation:

```python
# In 17_testing.ipynb
#| doc
"""
# Testing Utilities

This notebook provides testing helpers specifically designed for FastHTML SaaS apps.
All test utilities are demonstrated with examples that also serve as tests themselves.
"""

#| export
import os
import asyncio
import sqlite3
import tempfile
from typing import Dict, Any, Optional
from datetime import datetime
from contextlib import contextmanager

class SaaSTestCase:
    """Base test case with SaaS-specific helpers"""
    
    def __init__(self):
        self.app = None
        self.client = None
        self.db = None
        self.session = {}
        
    def setup(self):
        """Set up test environment"""
        # Create test database
        self.db_file = tempfile.NamedTemporaryFile(delete=False)
        self.db = sqlite3.connect(self.db_file.name)
        
        # Create test app with test config
        from launch_kit import create_saas_app, SaaSConfig
        config = SaaSConfig(
            app_name="Test App",
            database_url=f"sqlite:///{self.db_file.name}",
            secret_key="test-secret-key",
            email_provider="console"  # Don't send real emails
        )
        self.app = create_saas_app(config)
        
        # Run migrations
        from launch_kit.db import run_migrations
        run_migrations(self.db)
        
    def teardown(self):
        """Clean up test environment"""
        self.db.close()
        self.db_file.close()
        os.unlink(self.db_file.name)
    
    def login_as(self, user):
        """Log in as a specific user for testing"""
        from launch_kit.auth import create_session
        session_token = create_session(user.id)
        self.session['session'] = session_token
        return session_token
        
    def create_user(self, **kwargs):
        """Create a test user with defaults"""
        from launch_kit.auth import hash_password
        defaults = {
            'username': 'testuser',
            'email': 'test@example.com',
            'password': 'testpass123!',
            'email_verified': True,
            'is_active': True
        }
        defaults.update(kwargs)
        
        # Hash password if provided
        if 'password' in defaults:
            password = defaults.pop('password')
            defaults['password_hash'] = hash_password(password)
        
        # Insert user
        cursor = self.db.execute(
            "INSERT INTO users (username, email, password_hash, email_verified, is_active) VALUES (?, ?, ?, ?, ?)",
            (defaults['username'], defaults['email'], defaults['password_hash'], 
             defaults['email_verified'], defaults['is_active'])
        )
        user_id = cursor.lastrowid
        
        # Return user object
        from launch_kit.models import User
        return User(id=user_id, **defaults)
    
    def create_team(self, owner, **kwargs):
        """Create a test team"""
        defaults = {
            'name': 'Test Team',
            'slug': 'test-team',
            'subscription_tier': 'free'
        }
        defaults.update(kwargs)
        
        cursor = self.db.execute(
            "INSERT INTO teams (name, slug, owner_id, subscription_tier) VALUES (?, ?, ?, ?)",
            (defaults['name'], defaults['slug'], owner.id, defaults['subscription_tier'])
        )
        team_id = cursor.lastrowid
        
        # Add owner as team member
        self.db.execute(
            "INSERT INTO team_members (team_id, user_id, role) VALUES (?, ?, ?)",
            (team_id, owner.id, 'owner')
        )
        
        from launch_kit.models import Team
        return Team(id=team_id, owner_id=owner.id, **defaults)
        
    def assertSubscriptionActive(self, team, tier=None):
        """Assert team has active subscription"""
        assert team.subscription_status == "active", f"Expected active subscription, got {team.subscription_status}"
        if tier:
            assert team.subscription_tier == tier, f"Expected {tier} tier, got {team.subscription_tier}"
    
    def assertEmailSent(self, to: str, subject: str = None):
        """Assert email was sent (when using console provider)"""
        # Check console output or email log
        # Implementation depends on email provider mock
        pass
    
    @contextmanager
    def assertRaises(self, exception_type):
        """Context manager for exception assertions"""
        try:
            yield
            raise AssertionError(f"Expected {exception_type.__name__} but no exception was raised")
        except exception_type:
            pass  # Expected
        except Exception as e:
            raise AssertionError(f"Expected {exception_type.__name__} but got {type(e).__name__}: {e}")

# Example test that also documents usage
#| test
def test_subscription_upgrade():
    """This test demonstrates the subscription upgrade flow"""
    # Create test data using factories
    user = factories.create_user()
    team = factories.create_team(owner=user)
    
    # Test the upgrade process
    test_case = SaaSTestCase()
    test_case.login_as(user)
    
    # Simulate upgrade
    team.upgrade_subscription("pro")
    
    # Verify results
    test_case.assertSubscriptionActive(team, tier="pro")
    
# Run the test
test_subscription_upgrade()
print("✓ Subscription upgrade test passed")

# Example of visual test result display
#| test
def run_all_tests():
    """Run all tests and display results visually"""
    test_results = [
        {"name": "test_user_creation", "status": "passed", "time": 0.023},
        {"name": "test_authentication", "status": "passed", "time": 0.145},
        {"name": "test_team_creation", "status": "passed", "time": 0.067},
        {"name": "test_subscription_upgrade", "status": "passed", "time": 0.089},
        {"name": "test_admin_access", "status": "failed", "time": 0.034, 
         "error": "AssertionError: Expected 403 but got 200"},
    ]
    
    # Display test summary
    passed = sum(1 for t in test_results if t["status"] == "passed")
    failed = sum(1 for t in test_results if t["status"] == "failed")
    total_time = sum(t["time"] for t in test_results)
    
    from IPython.display import HTML, display
    
    html = f"""
    <div style="border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin: 10px 0;">
        <h3>Test Results</h3>
        <div style="display: flex; gap: 20px; margin: 20px 0;">
            <div style="text-align: center;">
                <div style="font-size: 32px; font-weight: bold; color: #10b981;">{passed}</div>
                <div>Passed</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 32px; font-weight: bold; color: #ef4444;">{failed}</div>
                <div>Failed</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 32px; font-weight: bold;">{total_time:.3f}s</div>
                <div>Total Time</div>
            </div>
        </div>
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 2px solid #ddd;">
                    <th style="text-align: left; padding: 8px;">Test</th>
                    <th style="text-align: left; padding: 8px;">Status</th>
                    <th style="text-align: left; padding: 8px;">Time</th>
                </tr>
            </thead>
            <tbody>
    """
    
    for test in test_results:
        status_color = "#10b981" if test["status"] == "passed" else "#ef4444"
        status_icon = "✓" if test["status"] == "passed" else "✗"
        html += f"""
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 8px;">{test['name']}</td>
                    <td style="padding: 8px; color: {status_color};">{status_icon} {test['status']}</td>
                    <td style="padding: 8px;">{test['time']:.3f}s</td>
                </tr>
        """
        if test.get('error'):
            html += f"""
                <tr>
                    <td colspan="3" style="padding: 8px; color: #666; font-size: 14px;">
                        {test['error']}
                    </td>
                </tr>
            """
    
    html += """
            </tbody>
        </table>
    </div>
    """
    
    display(HTML(html))
    
    # Also show coverage report
    coverage_html = """
    <div style="border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin: 10px 0;">
        <h3>Coverage Report</h3>
        <div style="margin: 10px 0;">
            <div style="background: #f3f4f6; border-radius: 4px; overflow: hidden;">
                <div style="background: #10b981; color: white; padding: 4px 10px; width: 92%;">
                    92% Coverage
                </div>
            </div>
        </div>
        <table style="width: 100%; margin-top: 20px;">
            <tr><td>launch_kit/core.py</td><td style="text-align: right;">98%</td></tr>
            <tr><td>launch_kit/auth.py</td><td style="text-align: right;">95%</td></tr>
            <tr><td>launch_kit/admin.py</td><td style="text-align: right;">89%</td></tr>
            <tr><td>launch_kit/billing.py</td><td style="text-align: right;">87%</td></tr>
        </table>
    </div>
    """
    display(HTML(coverage_html))

# Run the visual test
run_all_tests()
```

#### Visual Test Results
Notebooks can display test results visually:
```python
#| test
# Run all tests and display results
results = run_notebook_tests()
display_test_summary(results)  # Shows green checkmarks, coverage, etc.
```

### 9. Deployment Support

#### Configuration
```python
# config/production.py
from launch_kit import ProductionConfig

config = ProductionConfig(
    # Auto-configures from environment
    database_url=os.environ.get("DATABASE_URL"),
    redis_url=os.environ.get("REDIS_URL"),
    
    # Production defaults
    debug=False,
    secure_cookies=True,
    force_https=True,
    
    # Monitoring
    sentry_dsn=os.environ.get("SENTRY_DSN"),
    metrics_enabled=True,
)
```

#### Deployment Files
- Dockerfile with multi-stage build
- docker-compose.yml for local dev
- Kubernetes manifests
- GitHub Actions workflows
- Render.com blueprint
- Fly.io configuration

### 10. Documentation & Examples

#### nbdev-Generated Documentation
The entire documentation is generated from notebooks, ensuring it's always up-to-date:

- **Interactive Documentation**: All code examples are runnable
- **API Reference**: Auto-generated from notebook docstrings
- **Visual Examples**: UI components shown with rendered output
- **Test Results**: Tests run during doc generation ensure examples work

#### Tutorial Notebooks
Each tutorial is a complete, runnable notebook:
```
tutorials/
├── 01_getting_started.ipynb    # Basic setup and first app
├── 02_authentication.ipynb     # Deep dive into auth
├── 03_building_admin.ipynb     # Creating admin interfaces
├── 04_deployment.ipynb         # Production deployment
└── 05_advanced_patterns.ipynb  # Complex use cases
```

#### Example Applications
Complete example apps as notebooks:
- **Simple SaaS**: `examples/01_quickstart.ipynb`
- **Multi-tenant B2B**: `examples/02_b2b_saas.ipynb`
- **API Platform**: `examples/03_api_first.ipynb`
- **Marketplace**: `examples/04_marketplace.ipynb`

Each example can be:
1. Run interactively in Jupyter
2. Exported to a standalone Python app
3. Used as a template for new projects

### 11. Future Roadmap

Future modules, each developed as notebooks:
- **Analytics Module**: User tracking, funnel analysis
- **A/B Testing**: Feature flag based experiments  
- **Internationalization**: Multi-language support
- **Compliance**: GDPR tools, data export
- **Marketplace**: App marketplace functionality
- **Mobile API**: React Native / Flutter integration
- **AI Integration**: LLM features, embeddings
- **Real-time**: WebSocket support for live features

## Summary

The `launch-kit` package, built with nbdev, would provide:

1. **Literate Programming**: All code developed in notebooks with inline documentation and tests
2. **Interactive Development**: See UI components and test results directly in notebooks
3. **Automatic Documentation**: Beautiful docs generated from notebooks
4. **Integrated Testing**: Tests live with the code they test
5. **FastHTML Alignment**: Following the same development methodology as FastHTML itself

This approach combines the best of both worlds:
- The rapid development and excellent documentation of nbdev
- The simplicity and power of FastHTML for web applications
- Production-ready SaaS features out of the box

The result is a toolkit that not only accelerates SaaS development but also serves as a learning resource through its interactive notebooks, making it easy for developers to understand, customize, and extend.